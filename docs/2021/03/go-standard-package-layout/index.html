<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        [Go] standard package layout - UnderTheHood
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content="Standard Package Layout æ ‡å‡†åŒ…å¸ƒå±€ -Ben Johnson https://www.gobeyond.dev/standard-package-layout/ Vendoringå’ŒGenerics,å®ƒä»¬åœ¨goç¤¾åŒºä¼¼ä¹éƒ½æ˜¯big issue,ä½†è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘æåŠçš„issue,å°±æ˜¯åº”ç”¨" />
    <meta name="generator" content="Hugo 0.81.0 with theme pure" />
    <title>[Go] standard package layout - UnderTheHood</title>
    
    
    <link rel="stylesheet" href="https://liwm29.github.io/css/style.min.6f90022f237877ae2514ec95f3c9cca9f2314394f20800ca037a497e20053122.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:title" content="[Go] standard package layout" />
<meta property="og:description" content="Standard Package Layout æ ‡å‡†åŒ…å¸ƒå±€ -Ben Johnson https://www.gobeyond.dev/standard-package-layout/ Vendoringå’ŒGenerics,å®ƒä»¬åœ¨goç¤¾åŒºä¼¼ä¹éƒ½æ˜¯big issue,ä½†è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘æåŠçš„issue,å°±æ˜¯åº”ç”¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liwm29.github.io/2021/03/go-standard-package-layout/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-25T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-03-25T00:00:00&#43;00:00" />

<meta itemprop="name" content="[Go] standard package layout">
<meta itemprop="description" content="Standard Package Layout æ ‡å‡†åŒ…å¸ƒå±€ -Ben Johnson https://www.gobeyond.dev/standard-package-layout/ Vendoringå’ŒGenerics,å®ƒä»¬åœ¨goç¤¾åŒºä¼¼ä¹éƒ½æ˜¯big issue,ä½†è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘æåŠçš„issue,å°±æ˜¯åº”ç”¨"><meta itemprop="datePublished" content="2021-03-25T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-03-25T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="4920">
<meta itemprop="keywords" content="Go," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Go] standard package layout"/>
<meta name="twitter:description" content="Standard Package Layout æ ‡å‡†åŒ…å¸ƒå±€ -Ben Johnson https://www.gobeyond.dev/standard-package-layout/ Vendoringå’ŒGenerics,å®ƒä»¬åœ¨goç¤¾åŒºä¼¼ä¹éƒ½æ˜¯big issue,ä½†è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘æåŠçš„issue,å°±æ˜¯åº”ç”¨"/>

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://github.com/liwm29" target="_blank">
            <img class="img-circle img-rotate" src="https://liwm29.github.io/me.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">Li Weiming</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">liwm29@sysu.sdcs</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Guangzhou, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p>ğŸ’•ğŸ˜ğŸ±â€ğŸ‘¤ğŸ±â€ğŸâœ¨</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> Tags</h3>
    <div id="tag-cloud-list" class="widget-body">
            
            
            <a href="https://liwm29.github.io/tags/alg/" class="tag-list-link" rel="1">alg<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/arch/" class="tag-list-link" rel="1">arch<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/bytedance/" class="tag-list-link" rel="1">bytedance<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/c/" class="tag-list-link" rel="1">c<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/cache/" class="tag-list-link" rel="1">cache<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/cli/" class="tag-list-link" rel="2">cli<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://liwm29.github.io/tags/concurrency/" class="tag-list-link" rel="1">concurrency<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/data-structure/" class="tag-list-link" rel="1">data-structure<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/db/" class="tag-list-link" rel="4">db<span
               class="tag-list-count">4</span></a>
            
            
            <a href="https://liwm29.github.io/tags/deploy/" class="tag-list-link" rel="1">deploy<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/go/" class="tag-list-link" rel="16">go<span
               class="tag-list-count">16</span></a>
            
            
            <a href="https://liwm29.github.io/tags/http/" class="tag-list-link" rel="1">http<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/interview/" class="tag-list-link" rel="3">interview<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://liwm29.github.io/tags/lock-free/" class="tag-list-link" rel="1">lock-free<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/mem/" class="tag-list-link" rel="2">mem<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://liwm29.github.io/tags/other/" class="tag-list-link" rel="3">other<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://liwm29.github.io/tags/protocol/" class="tag-list-link" rel="1">protocol<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/rpc/" class="tag-list-link" rel="4">rpc<span
               class="tag-list-count">4</span></a>
            
            
            <a href="https://liwm29.github.io/tags/server/" class="tag-list-link" rel="3">server<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://liwm29.github.io/tags/socket/" class="tag-list-link" rel="1">socket<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://liwm29.github.io/tags/sys/" class="tag-list-link" rel="3">sys<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://liwm29.github.io/tags/vue/" class="tag-list-link" rel="2">vue<span
               class="tag-list-count">2</span></a>
            
    </div>
<script>
document.onreadystatechange = () => {
  if (document.readyState === 'complete') {
    tagCloud('#tag-cloud-list a',  8 ,  20 );
  }
};

function tagCloud(where, min, max) {
  let iMax = 0;
  let iMin = 0;
  $(where).each(function() {
    let weight = Number($(this).attr("rel"));
    if(iMax < weight) iMax = weight;
    if(iMin > weight || iMin == 0) iMin = weight;
  });
  let step = (max - min)/(iMax - iMin);
  $(where).each(function() {
    let weight = $(this).attr("rel") - iMin;
    $(this).css({"font-size": min + (weight * step) + 'px'});
  });
};
</script>
</div>

      <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/alg/" class="category-list-link">alg</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/arch/" class="category-list-link">arch</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/bytedance/" class="category-list-link">bytedance</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/c/" class="category-list-link">c</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/cache/" class="category-list-link">cache</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/cli/" class="category-list-link">cli</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/concurrency/" class="category-list-link">concurrency</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/data-structure/" class="category-list-link">data-structure</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/db/" class="category-list-link">db</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/deploy/" class="category-list-link">deploy</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/go/" class="category-list-link">go</a><span class="category-list-count">16</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/http/" class="category-list-link">http</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/innodb/" class="category-list-link">innodb</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/interview/" class="category-list-link">interview</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/kafka/" class="category-list-link">kafka</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/linux/" class="category-list-link">linux</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/lock-free/" class="category-list-link">lock-free</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/mem/" class="category-list-link">mem</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/mq/" class="category-list-link">mq</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/other/" class="category-list-link">other</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/protocol/" class="category-list-link">protocol</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/rpc/" class="category-list-link">rpc</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/sys/" class="category-list-link">sys</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://liwm29.github.io/categories/vue/" class="category-list-link">vue</a><span class="category-list-count">2</span></li>
        </ul>
    </div>
</div>
      <div class="widget">
    <h3 class="widget-title"> Tags</h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/alg/" class="tag-list-link">alg</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/arch/" class="tag-list-link">arch</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/bytedance/" class="tag-list-link">bytedance</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/c/" class="tag-list-link">c</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/cache/" class="tag-list-link">cache</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/cli/" class="tag-list-link">cli</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/concurrency/" class="tag-list-link">concurrency</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/data-structure/" class="tag-list-link">data-structure</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/db/" class="tag-list-link">db</a><span
                    class="tag-list-count">4</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/deploy/" class="tag-list-link">deploy</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/go/" class="tag-list-link">go</a><span
                    class="tag-list-count">16</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/http/" class="tag-list-link">http</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/interview/" class="tag-list-link">interview</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/lock-free/" class="tag-list-link">lock-free</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/mem/" class="tag-list-link">mem</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/other/" class="tag-list-link">other</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/protocol/" class="tag-list-link">protocol</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/rpc/" class="tag-list-link">rpc</a><span
                    class="tag-list-count">4</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/server/" class="tag-list-link">server</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/socket/" class="tag-list-link">socket</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/sys/" class="tag-list-link">sys</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://liwm29.github.io/tags/vue/" class="tag-list-link">vue</a><span
                    class="tag-list-count">2</span></li>
            
        </ul>

    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://liwm29.github.io/2021/03/mq-kafka1-intro/" class="title">kafka1 intro</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-03-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-29</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://liwm29.github.io/2021/03/other-go/" class="title">[Other] Go</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-03-27 21:09:05 &#43;0800 CST" itemprop="datePublished">2021-03-27</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://liwm29.github.io/2021/03/interview-bytedance2/" class="title">[interview] ByteDance2</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-03-27 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-27</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://liwm29.github.io/2021/03/rpc-grpc/" class="title">[rpc] grpc</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-03-27 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-27</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://liwm29.github.io/2021/03/rpc-intro/" class="title">[rpc] intro</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-03-27 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-27</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Catalogue</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/2021/03/go-standard-package-layout/"
    >[Go] standard package layout</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://liwm29.github.io/2021/03/go-standard-package-layout/" class="article-date">
  <time datetime="2021-03-25 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-03-25</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/go/"> Go </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/go/"> Go </a>
  </span>

		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 4920 words</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Time: 10 minutes </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <h1 id="standard-package-layout">Standard Package Layout</h1>
<p>æ ‡å‡†åŒ…å¸ƒå±€   -Ben Johnson <a href="https://www.gobeyond.dev/standard-package-layout/">https://www.gobeyond.dev/standard-package-layout/</a></p>
<p>Vendoringå’ŒGenerics,å®ƒä»¬åœ¨goç¤¾åŒºä¼¼ä¹éƒ½æ˜¯big issue,ä½†è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘æåŠçš„issue,å°±æ˜¯åº”ç”¨çš„åŒ…å¸ƒå±€(application package layout)</p>
<p>æ¯ä¸ªæˆ‘æ‰€å‚ä¸çš„goåº”ç”¨éƒ½ä¼¼ä¹å¯¹ä¸€ä¸ªé—®é¢˜æœ‰ä¸åŒçš„ç­”æ¡ˆ,æˆ‘åº”è¯¥å¦‚ä½•ç»„ç»‡æˆ‘çš„ä»£ç ?æœ‰äº›åº”ç”¨å°†æ‰€æœ‰ä¸œè¥¿å †åˆ°ä¸€ä¸ªåŒ…é‡Œé¢,ä½†æ˜¯è¿˜æœ‰ä¸€äº›åº”ç”¨ä¼šé€‰æ‹©æŒ‰typeæˆ–moduleæ¥åˆ†ç»„. å¦‚æœæ²¡æœ‰ä¸€ä¸ªå¥½çš„ç­–ç•¥èƒ½åœ¨æ•´ä¸ªå›¢é˜Ÿä¸­è´¯å½»ä½¿ç”¨,ä½ ä¼šå‘ç°ä»£ç ä¼šåˆ†æ•£åœ¨åº”ç”¨çš„å„ä¸ªåŒ…ä¸­(è¯‘è€…æ³¨:å³å¼ºè€¦åˆ).æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¥½çš„goåº”ç”¨è®¾è®¡çš„æ ‡å‡†</p>
<p>æˆ‘å»ºè®®è¿™æ ·çš„ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•. é€šè¿‡éµå¾ªä¸€äº›ç®€å•çš„è§„åˆ™æˆ‘ä»¬å¯ä»¥è§£è€¦æˆ‘ä»¬çš„ä»£ç ,ä½¿å¾—å®ƒæ›´åŠ å®¹æ˜“æµ‹è¯•,å¹¶ä¸”ä¸ºæˆ‘ä»¬çš„é¡¹ç›®å¸¦æ¥ä¸€è‡´æ€§çš„ç»“æ„.åœ¨æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¹‹å‰,å…ˆçœ‹çœ‹ç°åœ¨æœ€å¸¸è§çš„ä¸€äº›äººä»¬ç»„ç»‡åŒ…çš„æ–¹æ³•</p>
<h2 id="æœ‰ç¼ºé™·çš„æ–¹æ³•">æœ‰ç¼ºé™·çš„æ–¹æ³•</h2>
<p>ä¼¼ä¹å­˜åœ¨ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æ¥ç»„ç»‡goåŒ…,ä½†å®ƒä»¬éƒ½æœ‰è¿™è‡ªå·±å„è‡ªçš„ç¼ºé™·</p>
<h3 id="æ–¹æ³•1-å•åŒ…è¯‘è€…æ³¨ç±»æ¯”å•å†…æ ¸å®å†…æ ¸">æ–¹æ³•#1: å•åŒ…(è¯‘è€…æ³¨:ç±»æ¯”å•å†…æ ¸/å®å†…æ ¸)</h3>
<p>å°†ä½ çš„ä»£ç æ‰”åœ¨ä¸€ä¸ªåŒ…é‡Œç¡®å®å¯¹äºä¸€äº›å°åº”ç”¨æ¥è¯´å¯ä»¥è¿è¡Œçš„å¾ˆå¥½.å®ƒé¿å…äº†å¾ªç¯ä¾èµ–çš„å¯èƒ½,å› ä¸ºåœ¨ä½ çš„åº”ç”¨é‡Œé¢,æ²¡æœ‰ä»»ä½•ä¾èµ–(è¯‘è€…æ³¨:å³å¼•ç”¨åˆ«çš„åŒ…)</p>
<p>æˆ‘æ›¾çœ‹è§è¿‡è¿™æ ·çš„æ–¹å¼èƒ½å¯¹è‡³å¤š10kè¡Œæºç çš„åº”ç”¨èµ·æ•ˆ.ä½†è¶…è¿‡è¿™ä¸ªå¤§å°å,å°±ä¼šä½¿æµè§ˆä»£ç å’Œéš”ç¦»ä»£ç å˜å¾—éå¸¸å›°éš¾</p>
<h3 id="æ–¹æ³•2-railsé£æ ¼å¸ƒå±€">æ–¹æ³•#2: Railsé£æ ¼å¸ƒå±€</h3>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯æŒ‰åŠŸèƒ½ç±»å‹æ¥å¯¹ä»£ç åˆ†åŒ….æ¯”å¦‚,ä½ æ‰€æœ‰çš„handlersæ”¾åœ¨ä¸€ä¸ªpackage,æ‰€æœ‰çš„controllersæ”¾åœ¨ä¸€ä¸ªpackage,æ‰€æœ‰çš„modelsæ”¾åœ¨ä¸€ä¸ªpackage.æˆ‘åœ¨è¿‡å»çš„Railså¼€å‘è€…ä¸­ç»å¸¸çœ‹è§è¿™ç§å¸ƒå±€</p>
<p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä»ç„¶å­˜åœ¨ä¸¤ä¸ªé—®é¢˜.é¦–å…ˆ,ä½ çš„å‘½åæ˜¯atrociousçš„.ä½ æœ€ç»ˆå¾—åˆ°ç±»ä¼¼controller.UserControllerè¿™æ ·çš„ç±»å‹åç§°,è¿™æ„å‘³ç€ä½ åœ¨ç±»å‹åä¸­é‡å¤äº†åŒ…å.æˆ‘å€¾å‘äºå¯¹å‘½åæœ‰ä¸€å®šçš„è´¨é‡è¦æ±‚(stickler).å½“ä½ é™·å…¥æ‚è‰èˆ¬çš„ä»£ç ä¸­æ—¶,æˆ‘ç›¸ä¿¡åå­—æ˜¯æœ€å¥½çš„æ–‡æ¡£.åå­—ä¹Ÿè¢«ç”¨ä½œæ˜¯å¯¹ä»£ç è´¨é‡çš„ä»£ç†(è¯‘è€…æ³¨:å³å‘½åæ˜¯ä»£ç è´¨é‡çš„å¤–æ˜¾/ä¸€éƒ¨åˆ†)(a proxy for quality)-å› ä¸ºå®ƒæ˜¯æŸä¸ªäººé˜…è¯»ä»£ç æ—¶æœ€å…ˆæ³¨æ„åˆ°çš„ä¸œè¥¿.</p>
<p>ä½†æ˜¯,æœ€å¤§çš„é—®é¢˜æ˜¯ç¯å½¢ä¾èµ–. ä¸åŒçš„åŠŸèƒ½ç±»å‹ä¹Ÿè®¸éœ€è¦äº’ç›¸å¼•ç”¨å½¼æ­¤. è¿™æ ·çš„æŒ‰åŠŸèƒ½ç±»å‹åˆ†åŒ…çš„å¸ƒå±€åªä¼šåœ¨ä½ çš„ä¾èµ–éƒ½æ˜¯å•å‘æ—¶æ‰æœ‰æ•ˆ,ä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä½ çš„åº”ç”¨éƒ½ä¸ä¼šé‚£ä¹ˆç®€å•.</p>
<h3 id="æ–¹æ³•3-æŒ‰æ¨¡å—åˆ†åŒ…">æ–¹æ³•#3: æŒ‰æ¨¡å—åˆ†åŒ…</h3>
<blockquote>
<p>è¯‘è€…æ³¨: ç±»ä¼¼äºæŒ‰ç…§ç±»æ¥åˆ†åŒ…?</p>
</blockquote>
<p>è¿™ä¸ªæ–¹æ³•ä¸Railsé£æ ¼å¸ƒå±€ç›¸ä¼¼,ä½†æ­¤æ—¶æˆ‘ä»¬æŒ‰æ¨¡å—è¿›è¡Œåˆ†åŒ…æ¥ç»„ç»‡æˆ‘ä»¬çš„ä»£ç ,è€Œä¸æ˜¯åŠŸèƒ½.æ¯”å¦‚,ä½ æœ‰ä¸€ä¸ªusersåŒ…å’Œä¸€ä¸ªaccountsåŒ….</p>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­,æˆ‘ä»¬å°†ä¼šå‘ç°å’ŒRailsé£æ ¼ä¸­åŒæ ·çš„é—®é¢˜.å†ä¸€æ¬¡,æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ç±»ä¼¼users.Userè¿™æ ·ç³Ÿç³•çš„å‘½å.æˆ‘ä»¬ä¹ŸåŒæ ·é¢ä¸´ç¯å½¢ä¾èµ–çš„é—®é¢˜,å¦‚æœaccounts.Controlleréœ€è¦å’Œusers.Controllerè¿›è¡Œäº¤äº’,åä¹‹äº¦ç„¶.</p>
<h2 id="ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•">ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•</h2>
<p>æˆ‘ä½¿ç”¨çš„åº”ç”¨åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­çš„åˆ†åŒ…ç­–ç•¥åŒ…æ‹¬å››ä¸ªç®€å•çš„å®—æ—¨:</p>
<ol>
<li>æ ¹åŒ…ç”¨äºé¢†åŸŸç±»å‹(è¯‘è€…æ³¨:æ ¹åŒ…å³net/httpä¸­çš„net,å…¶å«æœ‰ä¸httpå­åŒ…å¹¶åˆ—çš„ä»£ç æ–‡ä»¶)</li>
<li>æŒ‰ä¾èµ–å¯¹å­åŒ…åˆ†ç»„</li>
<li>ä½¿ç”¨å…±äº«çš„mockå­åŒ…(mockæ¨¡æ‹Ÿ,è¯‘è€…æ³¨:ç”¨äºæµ‹è¯•)</li>
<li>MainåŒ…å°†æ†ç»‘æ‰€æœ‰ä¾èµ–(è¯‘è€…æ³¨:MainåŒ…æ˜¯å¯æ‰§è¡ŒåŒ…,å°†ä¼šå¼•ç”¨æ‰€æœ‰éœ€è¦çš„ä¾èµ–,æ­¤å¤–çš„å­åŒ…ä¸å¯ä»¥å¹³è¡Œå¼•ç”¨å­åŒ…)</li>
</ol>
<p>è¿™äº›è§„åˆ™å¸®åŠ©éš”ç¦»æˆ‘ä»¬çš„åŒ…å’Œåœ¨æ•´ä¸ªåº”ç”¨ä¸­å®šä¹‰ä¸€ä¸ªæ¸…æ™°çš„é¢†åŸŸè¯­è¨€.è®©æˆ‘ä»¬çœ‹çœ‹æ¯ä¸€ä¸ªè§„åˆ™æ˜¯å¦‚ä½•åœ¨å®è·µä¸­ç”Ÿæ•ˆçš„</p>
<h3 id="1æ ¹åŒ…ç”¨äºé¢†åŸŸç±»å‹">1.æ ¹åŒ…ç”¨äºé¢†åŸŸç±»å‹</h3>
<p>ä½ çš„åº”ç”¨æœ‰ä¸€ä¸ªé€»è¾‘çš„,é«˜å±‚æ¬¡çš„è¯­è¨€æ¥æè¿°æ•°æ®å’Œè¿›ç¨‹çš„äº¤äº’. è¿™å°±æ˜¯ä½ çš„é¢†åŸŸ(domain).å¦‚æœä½ æœ‰ä¸€ä¸ªç”µå•†åº”ç”¨,ä½ çš„é¢†åŸŸå°†åŒ…å«è¯¸å¦‚é¡¾å®¢,è´¦æˆ·,å¯¹ä¿¡ç”¨å¡æ”¶è´¹,å¤„ç†åº“å­˜ç­‰.å¦‚æœä½ æ˜¯Facebook,é‚£ä¹ˆä½ çš„é¢†åŸŸå°†æ˜¯ç”¨æˆ·,çˆ±å¥½,å…³ç³»ç½‘ç­‰. é¢†åŸŸæ‰€åŒ…å«çš„ä¸œè¥¿å°±æ˜¯ä¸€äº›ä¸ä¾èµ–äºä½ åº•å±‚æŠ€æœ¯çš„ä¸œè¥¿</p>
<p>æˆ‘å°†æˆ‘ä»¬çš„é¢†åŸŸç±»å‹æ”¾åœ¨æ ¹åŒ…ä¸­.è¿™ä¸ªåŒ…åªåŒ…å«ç®€å•çš„æ•°æ®ç±»å‹æ¯”å¦‚Userç»“æ„ä½“,ç”¨äºæŒæœ‰ç”¨æˆ·æ•°æ®æˆ–UserServiceæ¥å£ç”¨äºå­˜å–ç”¨æˆ·æ•°æ®</p>
<p>ä»£ç å¯èƒ½é•¿è¿™æ ·:</p>
<pre><code class="language-go">package myapp

type User struct {
	ID      int
	Name    string
	Address Address
}

type UserService interface {
	User(id int) (*User, error)
	Users() ([]*User, error)
	CreateUser(u *User) error
	DeleteUser(id int) error
}
</code></pre>
<p>è¿™ä¼šä½¿å¾—ä½ çš„æ ¹åŒ…éå¸¸å°. ä½ ä¹Ÿå¯ä»¥åŒ…å«æ‰§è¡Œæ“ä½œçš„ç±»å‹,ä½†å‰ææ˜¯å®ƒä»¬ä»…ä¾èµ–äºå…¶ä»–é¢†åŸŸç±»å‹.æ¯”å¦‚,ä½ å¯ä»¥æœ‰ä¸€ä¸ªç”¨äºå‘¨æœŸæ€§è½®è¯¢UserServiceçš„ç±»å‹.ä½†æ˜¯å®ƒä¸å¯ä»¥è®¿é—®å¤–éƒ¨çš„æœåŠ¡(service)æˆ–ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“.è¿™æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚.(è¯‘è€…æ³¨:å³ä¸èƒ½å¼•å…¥æ›´å¤šçš„åŒ…(å¤–éƒ¨åŒ…/å­åŒ…),åªèƒ½ç”¨ç°æœ‰çš„ç±»å‹)</p>
<p>æ ¹åŒ…ä¸åº”è¯¥ä¾èµ–å…¶ä»–ä»»ä½•åœ¨ä½ åº”ç”¨ä¸­çš„åŒ…(è¯‘è€…æ³¨:ä¸åº”è¯¥ä¾èµ–å­åŒ…)</p>
<h3 id="2æŒ‰ä¾èµ–æ¥åˆ†åŒ…">2.æŒ‰ä¾èµ–æ¥åˆ†åŒ…</h3>
<blockquote>
<p>(è¯‘è€…æ³¨:æ¯”å¦‚httpä¾èµ–åœ¨ä¸€ä¸ªåŒ…,æ•°æ®åº“ä¾èµ–åœ¨ä¸€ä¸ªåŒ…)</p>
</blockquote>
<p>å¦‚æœä½ çš„æ ¹åŒ…ä¸å…è®¸æœ‰å¤–éƒ¨çš„ä¾èµ–,é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»å°†è¿™äº›ä¾èµ–æ”¾ç½®åœ¨å­åŒ…ä¸­(è¯‘è€…æ³¨:æ ¹åŒ…ä¸åº”è¯¥æœ‰ä»»ä½•import).åœ¨è¿™ä¸ªå…³äºåŒ…å¸ƒå±€çš„æ–¹æ³•ä¸­,å­åŒ…ä½œä¸ºä¸€ä¸ªä½ çš„é¢†åŸŸå’Œä½ çš„å®ç°ä¹‹é—´çš„é€‚é…å™¨å­˜åœ¨(è¯‘è€…æ³¨:æ ¸å¿ƒè§‚ç‚¹,å­åŒ…ä½œä¸ºé¢†åŸŸä¸å®ç°çš„é€‚é…å™¨,è€Œå®ç°å°†ä½¿ç”¨å¤–éƒ¨ä¾èµ–,è¿™ä¸­é—´é€šè¿‡æ¥å£é€‚é…,ä¾¿äºmock)</p>
<p>æ¯”å¦‚,ä½ çš„UserServiceä¹Ÿè®¸ç”±Postgresqlæ”¯æŒ.ä½ å¯ä»¥åœ¨ä½ çš„åº”ç”¨ä¸­å¼•å…¥ä¸€ä¸ªåä¸ºpostgresçš„å­åŒ…ç”¨äºæä¾›postgres.UserServiceå®ç°(è¯‘è€…æ³¨:app.postgres.UserServiceç»“æ„ä½“å®ç°app.UserServiceæ¥å£)</p>
<pre><code class="language-go">package postgres

import (
	&quot;database/sql&quot;

	&quot;github.com/benbjohnson/myapp&quot;
	_ &quot;github.com/lib/pq&quot;
)

// UserService represents a PostgreSQL implementation of myapp.UserService.
type UserService struct {
	DB *sql.DB
}

// User returns a user for a given id.
func (s *UserService) User(id int) (*myapp.User, error) {
	var u myapp.User
	row := db.QueryRow(`SELECT id, name FROM users WHERE id = $1`, id)
	if row.Scan(&amp;u.ID, &amp;u.Name); err != nil {
		return nil, err
	}
	return &amp;u, nil
}

// implement remaining myapp.UserService interface...
</code></pre>
<p>è¿™æ®µä»£ç éš”ç¦»äº†æˆ‘ä»¬çš„Posgresqlä¾èµ–,ç®€åŒ–äº†æµ‹è¯•(è¯‘è€…æ³¨:è¿™ç§°ä¸ºä¾èµ–æ³¨å…¥)å’Œæä¾›äº†ç®€å•çš„æ–¹æ³•ç”¨äºæœªæ¥å¯èƒ½çš„è¿ç§»æ•°æ®åº“.å®ƒå¯ä»¥è¢«ç”¨ä½œä¸€ç§å¯æ’æ‹”æ¶æ„(pluggable architecture),å¦‚æœä½ å†³å®šæ”¯æŒå…¶ä»–çš„æ•°æ®åº“å®ç°æ¯”å¦‚BoltDB.</p>
<p>å®ƒä¹Ÿç»™äº†ä½ ä¸€ç§å¯¹å®ç°åˆ†å±‚çš„æ–¹æ³•.ä¹Ÿè®¸ä½ æƒ³è¦æŒæœ‰ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„,LRUç®—æ³•çš„cacheåœ¨PostgreSQLä¹‹å‰.é‚£ä¹ˆä½ åªéœ€è¦æ·»åŠ ä¸€ä¸ªå®ç°äº†UserServiceçš„UserCache,å®ƒå¯ä»¥åŒ…è£…(wrap)ä½ çš„PostgreSQLå®ç°(è¯‘è€…æ³¨:è£…é¥°æ¨¡å¼)</p>
<pre><code class="language-go">package myapp

// UserCache wraps a UserService to provide an in-memory cache.
type UserCache struct {
        cache   map[int]*User
        service UserService
}

// NewUserCache returns a new read-through cache for service.
func NewUserCache(service UserService) *UserCache {
        return &amp;UserCache{
                cache: make(map[int]*User),
                service: service,
        }
}

// User returns a user for a given id.
// Returns the cached instance if available.
func (c *UserCache) User(id int) (*User, error) {
	// Check the local cache first.
        if u := c.cache[id]]; u != nil {
                return u, nil
        }

	// Otherwise fetch from the underlying service.
        u, err := c.service.User(id)
        if err != nil {
        	return nil, err
        } else if u != nil {
        	c.cache[id] = u
        }
        return u, err
}
</code></pre>
<p>æˆ‘ä»¬åœ¨æ ‡å‡†åº“ä¸­ä¹Ÿçœ‹åˆ°äº†è¿™ç§æ–¹æ³•.io.Readeræ˜¯ä¸€ä¸ªé¢†åŸŸç±»å‹,ç”¨äºè¯»å­—èŠ‚,å®ƒçš„å®ç°æŒ‰ä¾èµ–è¿›è¡Œåˆ†ç»„(åˆ†åŒ…)&mdash;-tar.Reader,gzip.Reader,multipart.Reader. å®ƒä»¬ä¹Ÿå¯ä»¥è¢«åˆ†å±‚å èµ·æ¥,æˆ‘ä»¬ç»å¸¸å¯ä»¥çœ‹åˆ°os.Fileè¢«bufio.ReaderåŒ…è£…,å†è¢«gzip.ReaderåŒ…è£…,å†è¢«tar.ReaderåŒ…è£….</p>
<h4 id="ä¾èµ–ä¹‹é—´çš„ä¾èµ–">ä¾èµ–ä¹‹é—´çš„ä¾èµ–</h4>
<p>ä½ çš„ä¾èµ–ä»¬å¹¶æ²¡æœ‰éš”ç¦».ä½ ä¹Ÿè®¸ä¼šå­˜å‚¨Useræ•°æ®åˆ°PostgreSQLä¸­,ä½†ä½ çš„é‡‘èäº¤æ˜“æ•°æ®å­˜æ”¾åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡ä¸­,æ¯”å¦‚Strip. åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé€»è¾‘é¢†åŸŸç±»å‹æ¥åŒ…è£…Stripä¾èµ–&mdash;è®©æˆ‘ä»¬å«ä»–TrasactionService.</p>
<p>é€šè¿‡æ·»åŠ TransactionServiceåˆ°UserService,æˆ‘ä»¬è§£è€¦äº†è¿™ä¸¤ä¸ªä¾èµ–:(è¯‘è€…æ³¨:è¿™é‡Œæ˜¯myapp.posgres.UserService,è€Œä¸æ˜¯myapp.UserService,   myapp.posgres.UserServiceå®ç°äº†myapp.UserService)</p>
<pre><code class="language-go">type UserService struct {
	DB                 *sql.DB
	TransactionService myapp.TransactionService
}
</code></pre>
<p>ç°åœ¨è¿™äº›ä¾èµ–ä»…é€šè¿‡å…¬å…±é¢†åŸŸè¯­è¨€æ¥è¿›è¡Œé€šä¿¡. è¿™æ„å‘³è¿™æˆ‘ä»¬å¯ä»¥å°†PosgreSQLåˆ‡æ¢æˆMySql,æˆ–è€…åˆ‡æ¢Stripä¸ºå¦ä¸€ä¸ªæ”¯ä»˜å¤„ç†å™¨,è€Œä¸å½±å“å…¶ä»–ä¾èµ–.</p>
<h4 id="ä¸è¦å±€é™äºç¬¬ä¸‰æ–¹ä¾èµ–">ä¸è¦å±€é™äºç¬¬ä¸‰æ–¹ä¾èµ–</h4>
<blockquote>
<p>(è¯‘è€…æ³¨:å¯¹äºæ ‡å‡†åº“ä¹Ÿè¦éš”ç¦»)</p>
</blockquote>
<p>è¿™å¬èµ·æ¥å¯èƒ½å¾ˆå¥‡æ€ªï¼Œä½†æ˜¯æˆ‘ä¹Ÿä½¿ç”¨è¿™ç§ç›¸åŒçš„æ–¹æ³•æ¥éš”ç¦»æˆ‘çš„æ ‡å‡†åº“ä¾èµ–. ä¾‹å¦‚,net/httpåŒ…åªæ˜¯å¦ä¸€ä¸ªä¾èµ–. æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­åŒ…å«httpå­åŒ…æ¥éš”ç¦»å®ƒ.(è¯‘è€…æ³¨:æ‰€è°“éš”ç¦»ä¸€ä¸ªåŒ…,æ˜¯æŒ‡åªåœ¨ç‰¹å®šçš„åŒ…å¼•å…¥ä¸€ä¸ªåŒ…,è€Œä¸æ˜¯åœ¨åº”ç”¨ä¸­åˆ°å¤„å¼•ç”¨)</p>
<p>å…·æœ‰ä¸å…¶åŒ…è£…çš„ä¾èµ–ç›¸åŒåç§°çš„åŒ…ä¼¼ä¹å¾ˆå¥‡æ€ª,ä½†æ˜¯,æˆ‘æ˜¯æ•…æ„çš„. é™¤éæ‚¨å…è®¸åœ¨åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ä¸­ä½¿ç”¨net/httpï¼Œå¦åˆ™æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ²¡æœ‰ç¨‹åºåŒ…åç§°å†²çª. å¤åˆ¶åç§°çš„å¥½å¤„æ˜¯å®ƒè¦æ±‚ä½ å°†æ‰€æœ‰HTTPä»£ç (è¯‘è€…æ³¨:ä¸httpé€šä¿¡ç›¸å…³çš„ä»£ç )éš”ç¦»åˆ°httpåŒ…ä¸­.</p>
<pre><code class="language-go">package http

import (
        &quot;net/http&quot;
        
        &quot;github.com/benbjohnson/myapp&quot;
)

type Handler struct {
        UserService myapp.UserService
}

func (h *Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
        // handle request
}
</code></pre>
<p>ç°åœ¨ï¼Œhttp.Handlerå……å½“æ‚¨çš„åŸŸå’ŒHTTPåè®®ä¹‹é—´çš„é€‚é…å™¨</p>
<h3 id="3-ä½¿ç”¨å…±äº«çš„mockå­åŒ…">3. ä½¿ç”¨å…±äº«çš„mockå­åŒ…</h3>
<p>å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–é€šè¿‡é¢†åŸŸæ¥å£ä¸å…¶ä»–ä¾èµ–éš”ç¦»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›è¿æ¥ç‚¹æ¥æ³¨å…¥æ¨¡æ‹Ÿå®ç°.(è¯‘è€…æ³¨:ä¾èµ–æ³¨å…¥)</p>
<p>æœ‰è®¸å¤šæ¨¡æ‹Ÿåº“ï¼ˆä¾‹å¦‚GoMockï¼‰å¯ä»¥ä¸ºä½ ç”Ÿæˆæ¨¡æ‹Ÿï¼Œä½†æˆ‘ä¸ªäººæ›´å–œæ¬¢è‡ªå·±ç¼–å†™mock. å› ä¸ºæˆ‘å‘ç°è®¸å¤šæ¨¡æ‹Ÿå·¥å…·è¿‡äºå¤æ‚.</p>
<p>æˆ‘ä½¿ç”¨çš„æ¨¡æ‹Ÿéå¸¸ç®€å•. ä¾‹å¦‚, UserServiceçš„æ¨¡æ‹Ÿå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-go">package mock

import &quot;github.com/benbjohnson/myapp&quot;

// UserService represents a mock implementation of myapp.UserService.
type UserService struct {
        UserFn      func(id int) (*myapp.User, error)
        UserInvoked bool

        UsersFn     func() ([]*myapp.User, error)
        UsersInvoked bool

        // additional function implementations...
}

// User invokes the mock implementation and marks the function as invoked.
func (s *UserService) User(id int) (*myapp.User, error) {
        s.UserInvoked = true
        return s.UserFn(id)
}

// additional functions: Users(), CreateUser(), DeleteUser()
</code></pre>
<blockquote>
<p>è¯‘è€…æ³¨:æ­¤å¤„çš„mockåªæ¶‰åŠäº†æ˜¯å¦è°ƒç”¨,å¯¹äºæ›´verboseçš„mock,è¿˜å¯èƒ½æ¶‰åŠè°ƒç”¨é¡ºåºç­‰</p>
</blockquote>
<p>è¿™ä¸ªmockè®©æˆ‘ä»¬å¯ä»¥æ³¨å…¥å‡½æ•°åˆ°ä»»ä½•ä½¿ç”¨myapp.UserServiceæ¥å£çš„åœ°æ–¹,æˆ‘ä»¬å¯ä»¥å€Ÿæ­¤æ¥éªŒè¯å‚æ•°,è¿”å›æœŸæœ›æ•°æ®,æˆ–è€…æ³¨å…¥å¤±è´¥</p>
<p>æ¯”å¦‚æˆ‘ä»¬æƒ³æµ‹è¯•æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„http.Handler:</p>
<pre><code class="language-go">package http_test

import (
	&quot;testing&quot;
	&quot;net/http&quot;
	&quot;net/http/httptest&quot;

	&quot;github.com/benbjohnson/myapp/mock&quot;
)

func TestHandler(t *testing.T) {
	// Inject our mock into our handler.
	var us mock.UserService
	var h Handler
	h.UserService = &amp;us

	// Mock our User() call.
	us.UserFn = func(id int) (*myapp.User, error) {
		if id != 100 {
			t.Fatalf(&quot;unexpected id: %d&quot;, id)
		}
		return &amp;myapp.User{ID: 100, Name: &quot;susy&quot;}, nil
	}

	// Invoke the handler.
	w := httptest.NewRecorder()
	r, _ := http.NewRequest(&quot;GET&quot;, &quot;/users/100&quot;, nil)
	h.ServeHTTP(w, r)
	
	// Validate mock.
	if !us.UserInvoked {
		t.Fatal(&quot;expected User() to be invoked&quot;)
	}
}
</code></pre>
<p>mockè®©æˆ‘ä»¬å®Œå…¨éš”ç¦»å•å…ƒæµ‹è¯•åˆ°ä»…ä»…çš„httpåè®®çš„å¤„ç†ä¸Š(è¯‘è€…æ³¨:å¦‚æœæ²¡æœ‰mock,åˆ™å•å…ƒæµ‹è¯•å°†åŒ…å«UserServiceçš„åˆ›å»ºå’Œhttpåè®®çš„å¤„ç†,UserServiceçš„åˆ›å»ºå¯èƒ½ä¾èµ–å¾ˆå¤šä¸œè¥¿)</p>
<h3 id="4mainåŒ…å°†æ†ç»‘æ‰€æœ‰ä¾èµ–">4.MainåŒ…å°†æ†ç»‘æ‰€æœ‰ä¾èµ–</h3>
<p>ç°åœ¨æ‰€æœ‰è¿™äº›ä¾èµ–éƒ½è¢«éš”ç¦»åœ°æ¼‚æµ®åœ¨é‚£é‡Œäº†, æ‚¨å¯èƒ½æƒ³çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·çš„. è¿™å°±æ˜¯mainåŒ…çš„å·¥ä½œ.</p>
<h4 id="mainåŒ…çš„å¸ƒå±€">MainåŒ…çš„å¸ƒå±€</h4>
<p>ä¸€ä¸ªåº”ç”¨ä¹Ÿè®¸ä¼šäº§ç”Ÿå‡ºå¾ˆå¤šäºŒè¿›åˆ¶æ–‡ä»¶,æ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨Goçš„ä¼ ç»Ÿ,å°†mainåŒ…ä½œä¸ºcmdåŒ…çš„ä¸€ä¸ªå­ç›®å½•.æ¯”å¦‚,æˆ‘ä»¬çš„é¡¹ç›®ä¹Ÿè®¸æœ‰ä¸€ä¸ªmyappçš„æœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶,ä½†ä¹Ÿæœ‰ä¸€ä¸ªmyappctlçš„å®¢æˆ·ç«¯äºŒè¿›åˆ¶æ–‡ä»¶ç”¨äºé€šè¿‡ç»ˆç«¯ç®¡ç†æœåŠ¡å™¨.æˆ‘ä»¬åˆ—å‡ºè¿™ä¸ªmainåŒ…çš„å¸ƒå±€:</p>
<pre><code class="language-go">myapp/
    cmd/
        myapp/
            main.go
        myappctl/
            main.go
</code></pre>
<blockquote>
<p>è¯‘è€…æ³¨: ä¸€å®šè¦åœ¨app/cmdä¸‹å†åˆ›å»ºä¸€ä¸ªå­ç›®å½•,å¦åˆ™go build/go installå‡ºæ¥é»˜è®¤æ˜¯ç›®å½•å,å³cmd,ä¸”go installæ²¡åŠæ³•rename</p>
</blockquote>
<h4 id="ç¼–è¯‘æ—¶æ³¨å…¥ä¾èµ–">ç¼–è¯‘æ—¶æ³¨å…¥ä¾èµ–</h4>
<p>æœ¯è¯­&quot;ä¾èµ–æ³¨å…¥&quot;ä»å­—é¢ä¸Šæè¿°çš„å¹¶ä¸å¥½.å®ƒä½¿äººæƒ³åˆ°äº†å†—é•¿çš„Spring XMLæ–‡ä»¶. ä½†æ˜¯,è¿™ä¸ªæœ¯è¯­çœŸæ­£è¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬å°†è¦å‘å¯¹è±¡ä¼ é€’ä¾èµ–(è¯‘è€…æ³¨:ä½œä¸ºNewXXXå‡½æ•°çš„å‚æ•°ä¼ å…¥),è€Œä¸æ˜¯è¦æ±‚è¿™ä¸ªå¯¹è±¡è‡ªå·±å»ºç«‹æˆ–æ‰¾åˆ°ä¾èµ–.</p>
<p>mainåŒ…å°±æ˜¯æˆ‘ä»¬é€‰æ‹©å“ªä¸ªä¾èµ–è¢«æ³¨å…¥å“ªä¸ªå¯¹è±¡çš„åœ°æ–¹. å› ä¸ºmainåŒ…ç®€å•åœ°å°†ä¸€å°å—ä¸€å°å—çš„ä¾èµ–è¿æ¥åœ¨ä¸€èµ·(è¯‘è€…æ³¨:åŸæ–‡:wires up the pieces, å¯è§google/wireå‘½åç”±æ¥),å®ƒå¾€å¾€æ˜¯æ¯”è¾ƒå°ä¸”çç¢çš„ä»£ç :</p>
<pre><code class="language-go">package main

import (
	&quot;log&quot;
	&quot;os&quot;
	
	&quot;github.com/benbjohnson/myapp&quot;
	&quot;github.com/benbjohnson/myapp/postgres&quot;
	&quot;github.com/benbjohnson/myapp/http&quot;
)

func main() {
	// Connect to database.
	db, err := postgres.Open(os.Getenv(&quot;DB&quot;))
	if err != nil {
		log.Fatal(err)
	}
	defer db.Close()

	// Create services.
	us := &amp;postgres.UserService{DB: db}

	// Attach to HTTP handler.
	var h http.Handler
	h.UserService = us
	
	// start http server...
}
</code></pre>
<p>åŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„åˆ°,ä½ çš„mainåŒ…ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨(adapter). å®ƒè¿æ¥ç»ˆç«¯åˆ°ä½ çš„é¢†åŸŸ.</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>åº”ç”¨è®¾è®¡æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜. å­˜åœ¨å¤ªå¤šéœ€è¦åšå‡ºçš„è®¾è®¡å†³ç­–,å¹¶ä¸”å¦‚æœæ²¡æœ‰ä¸€ç³»åˆ—å¯é çš„åŸåˆ™å»æŒ‡å¼•ä½ ,é—®é¢˜å°†ä¼šè¢«å¼„å¾—æ›´ç³Ÿ. æˆ‘ä»¬ç ”ç©¶äº†å½“å‰Goåº”ç”¨ç¨‹åºè®¾è®¡çš„å‡ ç§æ–¹æ³•,å¹¶ä¸”å‘ç°äº†å®ƒä»¬çš„è®¸å¤šç¼ºé™·.</p>
<p>æˆ‘ç›¸ä¿¡ä»ä¾èµ–å…³ç³»çš„æ¡€éªœéƒ½ç€æ‰‹è¿›è¡Œè®¾è®¡å°†ä¼šä½¿å¾—ä»£ç ç»„ç»‡çš„æ›´ç®€å•,ä¹Ÿæ›´å®¹æ˜“ç©¶å› . é¦–å…ˆæˆ‘ä»¬è®¾è®¡é¢†åŸŸè¯­è¨€.ç„¶åæˆ‘ä»¬éš”ç¦»ä¾èµ–.å†æ¥ç€æˆ‘ä»¬å¼•å…¥mockæ¥éš”ç¦»æµ‹è¯•. æœ€å,æˆ‘ä»¬å°†æ‰€æœ‰å†…å®¹æ†ç»‘åœ¨ä¸€èµ·æ”¾åœ¨mainåŒ…</p>
<p>åœ¨ä¸‹ä¸€ä¸ªä½ è®¾è®¡çš„åº”ç”¨ç¨‹åºä¸­è€ƒè™‘è¿™äº›åŸåˆ™. å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³è¦è®¨è®ºè®¾è®¡, contact me at <a href="https://twitter.com/benbjohnson">@benbjohnson</a> on Twitter or find me as <strong>benbjohnson</strong> on the <a href="https://gophersinvite.herokuapp.com/">Gopher slack</a>.</p>
<hr>
<p>è¯‘è€…: @https://github.com/liwm29</p>
<p>æ¦‚æ‹¬: æŒ‰ä¾èµ–åˆ†åŒ…,å„å­åŒ…å°†å®ç°æ ¹åŒ…å®šä¹‰çš„interface,ä¸”å®ƒä»¬ä¹‹é—´ä¸å¯ä»¥äº’ç›¸import. æ ¹åŒ…å®šä¹‰é¢†åŸŸç±»å‹,å¦‚æœä¾èµ–å¤–éƒ¨æœåŠ¡,åˆ™å®šä¹‰interface.æœ€ç»ˆåœ¨cmd/app/main.goä¸­å®Œæˆä¾èµ–æ³¨å…¥</p>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="https://liwm29.github.io/2021/03/go-standard-package-layout/" title="[Go] standard package layout" target="_blank" rel="external">https://liwm29.github.io/2021/03/go-standard-package-layout/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License: </strong>
        <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/liwm29" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://liwm29.github.io/me.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/liwm29" target="_blank"><span class="text-dark">Li Weiming</span><small class="ml-1x">liwm29@sysu.sdcs</small></a></h3>
        <div>ONE CAN GO FAST</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://liwm29.github.io/2021/03/go-user-thread/" title="[Go] user thread"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://liwm29.github.io/2021/03/go-slice-index-detail/"
                    title="[Go] slice index detail"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Catalogue</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/liwm29" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://liwm29.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2021  -
    2021
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/go.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://liwm29.github.io/js/application.min.a94ab19cb63a95c8d7fbd7b85cab3ddeea8c369bdf75b9cab6708787ead123af.js"></script>
<script src="https://liwm29.github.io/js/plugin.min.19c5bcb2fb0789ab4f2b7834e5ceb5e92635645605bab902c1024b25f1502364.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: 'https:\/\/liwm29.github.io\/',
            CONTENT_URL: 'https:\/\/liwm29.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://liwm29.github.io/js/insight.min.4a2d52de4bfff73e0c688404fe3d17c9a3ae12d9888e1e1ac9c690e4890de2ded50fe55f2b819c2ba55435a76f396f3ea6805765f0b0af5635cdf74ea459eab0.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>


  </body>
</html>
