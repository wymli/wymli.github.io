<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
        [AI Agent] Eino - UnderTheHood
      </title>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    
    <meta name="theme-color" content="#000000" />
    
    <meta http-equiv="window-target" content="_top" />
    
    
    <meta name="description" content=" åŸæ–‡æˆ‘è®°å½•åœ¨é£ä¹¦æ–‡æ¡£: https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b æ‹·è´æ—¶ä¼šæœ‰æ ¼å¼é—®é¢˜
Eino æ˜¯å­—èŠ‚å¼€æºçš„golangå†™çš„ ai agent å¼€å‘æ¡†æ¶ï¼Œç±»ä¼¼pythonå†™çš„langchainã€llamaindexã€‚ Ai agent æ™ºèƒ½ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§å®Œæˆ â€œæ„ŸçŸ¥ã€æ€è€ƒã€æ‰§è¡Œâ€ çš„ç¨‹åºï¼Œå…¶ä¸­æ€è€ƒçš„éƒ¨åˆ†å€ŸåŠ©å¤§æ¨¡å‹å®Œæˆ å¤§æ¨¡å‹æœ‰ä¸‰ç§ä¸»è¦çš„åº”ç”¨æ¨¡å¼ï¼š
" />
    <meta name="generator" content="Hugo 0.145.0 with theme pure" />
    <title>[AI Agent] Eino - UnderTheHood</title>
    
    
    <link rel="stylesheet" href="https://wymli.github.io/css/style.min.31c841d028bbb1b4f57eadc51e8f652fb1d4f783171c15f4f5de039708e133b3.css">
    
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css" async>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css" async>
    <meta property="og:url" content="https://wymli.github.io/2025/05/aiagent-eino/">
  <meta property="og:site_name" content="UnderTheHood">
  <meta property="og:title" content="[AI Agent] Eino">
  <meta property="og:description" content="åŸæ–‡æˆ‘è®°å½•åœ¨é£ä¹¦æ–‡æ¡£: https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b æ‹·è´æ—¶ä¼šæœ‰æ ¼å¼é—®é¢˜
Eino æ˜¯å­—èŠ‚å¼€æºçš„golangå†™çš„ ai agent å¼€å‘æ¡†æ¶ï¼Œç±»ä¼¼pythonå†™çš„langchainã€llamaindexã€‚ Ai agent æ™ºèƒ½ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§å®Œæˆ â€œæ„ŸçŸ¥ã€æ€è€ƒã€æ‰§è¡Œâ€ çš„ç¨‹åºï¼Œå…¶ä¸­æ€è€ƒçš„éƒ¨åˆ†å€ŸåŠ©å¤§æ¨¡å‹å®Œæˆ å¤§æ¨¡å‹æœ‰ä¸‰ç§ä¸»è¦çš„åº”ç”¨æ¨¡å¼ï¼š">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-05-16T00:00:00+00:00">
    <meta property="article:tag" content="Ai Agent">
    <meta property="article:tag" content="Eino">

  <meta itemprop="name" content="[AI Agent] Eino">
  <meta itemprop="description" content="åŸæ–‡æˆ‘è®°å½•åœ¨é£ä¹¦æ–‡æ¡£: https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b æ‹·è´æ—¶ä¼šæœ‰æ ¼å¼é—®é¢˜
Eino æ˜¯å­—èŠ‚å¼€æºçš„golangå†™çš„ ai agent å¼€å‘æ¡†æ¶ï¼Œç±»ä¼¼pythonå†™çš„langchainã€llamaindexã€‚ Ai agent æ™ºèƒ½ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§å®Œæˆ â€œæ„ŸçŸ¥ã€æ€è€ƒã€æ‰§è¡Œâ€ çš„ç¨‹åºï¼Œå…¶ä¸­æ€è€ƒçš„éƒ¨åˆ†å€ŸåŠ©å¤§æ¨¡å‹å®Œæˆ å¤§æ¨¡å‹æœ‰ä¸‰ç§ä¸»è¦çš„åº”ç”¨æ¨¡å¼ï¼š">
  <meta itemprop="datePublished" content="2025-05-16T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-05-16T00:00:00+00:00">
  <meta itemprop="wordCount" content="5531">
  <meta itemprop="keywords" content="Ai Agent,Eino">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[AI Agent] Eino">
  <meta name="twitter:description" content="åŸæ–‡æˆ‘è®°å½•åœ¨é£ä¹¦æ–‡æ¡£: https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b æ‹·è´æ—¶ä¼šæœ‰æ ¼å¼é—®é¢˜
Eino æ˜¯å­—èŠ‚å¼€æºçš„golangå†™çš„ ai agent å¼€å‘æ¡†æ¶ï¼Œç±»ä¼¼pythonå†™çš„langchainã€llamaindexã€‚ Ai agent æ™ºèƒ½ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§å®Œæˆ â€œæ„ŸçŸ¥ã€æ€è€ƒã€æ‰§è¡Œâ€ çš„ç¨‹åºï¼Œå…¶ä¸­æ€è€ƒçš„éƒ¨åˆ†å€ŸåŠ©å¤§æ¨¡å‹å®Œæˆ å¤§æ¨¡å‹æœ‰ä¸‰ç§ä¸»è¦çš„åº”ç”¨æ¨¡å¼ï¼š">

    <!--[if lte IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
      <![endif]-->

    <!--[if lt IE 9]>
        <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
      <![endif]-->
  </head>

  
  

  <body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader">
    <div class="slimContent">
      <div class="navbar-header">
        <div class="profile-block text-center">
          <a id="avatar" href="https://github.com/wymli" target="_blank">
            <img class="img-circle img-rotate" src="https://wymli.github.io/me.jpg" width="200" height="200">
          </a>
          <h2 id="name" class="hidden-xs hidden-sm">Li Weiming</h2>
          <h3 id="title" class="hidden-xs hidden-sm hidden-md">wymli@sysu.cse</h3>
          <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Guangzhou, China</small>
        </div><div class="search" id="search-form-wrap">
    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i
                        class="icon icon-search"></i></button>
            </span>
        </div>
        <div class="ins-search">
            <div class="ins-search-mask"></div>
            <div class="ins-search-container">
                <div class="ins-input-wrapper">
                    <input type="text" class="ins-search-input" placeholder="Type something..."
                        x-webkit-speech />
                    <button type="button" class="close ins-close ins-selectable" data-dismiss="modal"
                        aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="ins-section-wrapper">
                    <div class="ins-section-container"></div>
                </div>
            </div>
        </div>
    </form>
</div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
        <ul class="nav navbar-nav main-nav">
            <li class="menu-item menu-item-home">
                <a href="/">
                    <i class="icon icon-home-fill"></i>
                  <span class="menu-title">Home</span>
                </a>
            </li>
            <li class="menu-item menu-item-archives">
                <a href="/posts/">
                    <i class="icon icon-archives-fill"></i>
                  <span class="menu-title">Archives</span>
                </a>
            </li>
            <li class="menu-item menu-item-categories">
                <a href="/categories/">
                    <i class="icon icon-folder"></i>
                  <span class="menu-title">Categories</span>
                </a>
            </li>
            <li class="menu-item menu-item-tags">
                <a href="/tags/">
                    <i class="icon icon-tags"></i>
                  <span class="menu-title">Tags</span>
                </a>
            </li>
            <li class="menu-item menu-item-about">
                <a href="/about/">
                    <i class="icon icon-cup-fill"></i>
                  <span class="menu-title">About</span>
                </a>
            </li>
        </ul>
      </nav>
    </div>
  </header>

<aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content"><p>ğŸ’•ğŸ˜ğŸ±â€ğŸ‘¤ğŸ±â€ğŸâœ¨</p>
            </div>
        </div>
    </div>
</div>

      <div class="widget">
    <h3 class="widget-title"> Tags</h3>
    <div id="tag-cloud-list" class="widget-body">
            
            
            <a href="https://wymli.github.io/tags/ai-agent/" class="tag-list-link" rel="1">ai agent<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/airflow/" class="tag-list-link" rel="1">airflow<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/algorithm/" class="tag-list-link" rel="1">algorithm<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/arch/" class="tag-list-link" rel="1">arch<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/atomic/" class="tag-list-link" rel="1">atomic<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/bigdata/" class="tag-list-link" rel="3">bigdata<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://wymli.github.io/tags/bytedance/" class="tag-list-link" rel="1">bytedance<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/c/" class="tag-list-link" rel="2">c<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/cache/" class="tag-list-link" rel="1">cache<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/cli/" class="tag-list-link" rel="2">cli<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/concurrency/" class="tag-list-link" rel="1">concurrency<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/container/" class="tag-list-link" rel="6">container<span
               class="tag-list-count">6</span></a>
            
            
            <a href="https://wymli.github.io/tags/containerd/" class="tag-list-link" rel="1">containerd<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/database/" class="tag-list-link" rel="4">database<span
               class="tag-list-count">4</span></a>
            
            
            <a href="https://wymli.github.io/tags/datamining/" class="tag-list-link" rel="1">datamining<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/datastructure/" class="tag-list-link" rel="1">datastructure<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/db/" class="tag-list-link" rel="1">db<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/deploy/" class="tag-list-link" rel="1">deploy<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/designpattern/" class="tag-list-link" rel="1">designpattern<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/distribute/" class="tag-list-link" rel="1">distribute<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/eino/" class="tag-list-link" rel="1">eino<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/event-stream/" class="tag-list-link" rel="1">event-stream<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/golang/" class="tag-list-link" rel="20">golang<span
               class="tag-list-count">20</span></a>
            
            
            <a href="https://wymli.github.io/tags/http/" class="tag-list-link" rel="2">http<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/interview/" class="tag-list-link" rel="3">interview<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://wymli.github.io/tags/kafka/" class="tag-list-link" rel="5">kafka<span
               class="tag-list-count">5</span></a>
            
            
            <a href="https://wymli.github.io/tags/lsh/" class="tag-list-link" rel="1">lsh<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/oauth2/" class="tag-list-link" rel="1">oauth2<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/oci/" class="tag-list-link" rel="5">oci<span
               class="tag-list-count">5</span></a>
            
            
            <a href="https://wymli.github.io/tags/other/" class="tag-list-link" rel="2">other<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/overlayfs/" class="tag-list-link" rel="1">overlayfs<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/proc/" class="tag-list-link" rel="1">proc<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/redis/" class="tag-list-link" rel="1">redis<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/rpc/" class="tag-list-link" rel="4">rpc<span
               class="tag-list-count">4</span></a>
            
            
            <a href="https://wymli.github.io/tags/runc/" class="tag-list-link" rel="2">runc<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/script/" class="tag-list-link" rel="1">script<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/server/" class="tag-list-link" rel="3">server<span
               class="tag-list-count">3</span></a>
            
            
            <a href="https://wymli.github.io/tags/socket/" class="tag-list-link" rel="1">socket<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/sys/" class="tag-list-link" rel="2">sys<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/taskqueue/" class="tag-list-link" rel="1">taskqueue<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/temporal/" class="tag-list-link" rel="1">temporal<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/tensorflow/" class="tag-list-link" rel="1">tensorflow<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/todo/" class="tag-list-link" rel="1">todo<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/underthehood/" class="tag-list-link" rel="1">underthehood<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/ut/" class="tag-list-link" rel="1">ut<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/vue/" class="tag-list-link" rel="2">vue<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/workflow/" class="tag-list-link" rel="2">workflow<span
               class="tag-list-count">2</span></a>
            
            
            <a href="https://wymli.github.io/tags/wsl/" class="tag-list-link" rel="1">wsl<span
               class="tag-list-count">1</span></a>
            
            
            <a href="https://wymli.github.io/tags/zookeeper/" class="tag-list-link" rel="1">zookeeper<span
               class="tag-list-count">1</span></a>
            
    </div>
<script>
document.onreadystatechange = () => {
  if (document.readyState === 'complete') {
    tagCloud('#tag-cloud-list a',  8 ,  20 );
  }
};

function tagCloud(where, min, max) {
  let iMax = 0;
  let iMin = 0;
  $(where).each(function() {
    let weight = Number($(this).attr("rel"));
    if(iMax < weight) iMax = weight;
    if(iMin > weight || iMin == 0) iMin = weight;
  });
  let step = (max - min)/(iMax - iMin);
  $(where).each(function() {
    let weight = $(this).attr("rel") - iMin;
    $(this).css({"font-size": min + (weight * step) + 'px'});
  });
};
</script>
</div>

      <div class="widget">
    <h3 class="widget-title"> Categories</h3>
    <div class="widget-body">
        <ul class="category-list">
            <li class="category-list-item"><a href="https://wymli.github.io/categories/ai-agent/" class="category-list-link">ai agent</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/algorithm/" class="category-list-link">algorithm</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/arch/" class="category-list-link">arch</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/atomic/" class="category-list-link">atomic</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/bigdata/" class="category-list-link">bigdata</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/bytedance/" class="category-list-link">bytedance</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/c/" class="category-list-link">c</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/cache/" class="category-list-link">cache</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/cli/" class="category-list-link">cli</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/concurrency/" class="category-list-link">concurrency</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/configcenter/" class="category-list-link">configcenter</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/container/" class="category-list-link">container</a><span class="category-list-count">6</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/database/" class="category-list-link">database</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/datamining/" class="category-list-link">datamining</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/datastructure/" class="category-list-link">datastructure</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/db/" class="category-list-link">db</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/deploy/" class="category-list-link">deploy</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/distribute/" class="category-list-link">distribute</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/golang/" class="category-list-link">golang</a><span class="category-list-count">20</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/http/" class="category-list-link">http</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/install/" class="category-list-link">install</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/interview/" class="category-list-link">interview</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/linux/" class="category-list-link">linux</a><span class="category-list-count">3</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/messagequeue/" class="category-list-link">messagequeue</a><span class="category-list-count">5</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/os/" class="category-list-link">os</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/os-memory/" class="category-list-link">os-memory</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/other/" class="category-list-link">other</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/protocal/" class="category-list-link">protocal</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/protocol/" class="category-list-link">protocol</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/redis/" class="category-list-link">redis</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/rpc/" class="category-list-link">rpc</a><span class="category-list-count">4</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/script/" class="category-list-link">script</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/sys/" class="category-list-link">sys</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/taskqueue/" class="category-list-link">taskqueue</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/tensorflow/" class="category-list-link">tensorflow</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/todo/" class="category-list-link">todo</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/underthehood/" class="category-list-link">underthehood</a><span class="category-list-count">1</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/vue/" class="category-list-link">vue</a><span class="category-list-count">2</span></li>
            <li class="category-list-item"><a href="https://wymli.github.io/categories/workflow/" class="category-list-link">workflow</a><span class="category-list-count">2</span></li>
        </ul>
    </div>
</div>
      <div class="widget">
    <h3 class="widget-title"> Tags</h3>
    <div class="widget-body">
        <ul class="tag-list">
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/ai-agent/" class="tag-list-link">ai agent</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/airflow/" class="tag-list-link">airflow</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/algorithm/" class="tag-list-link">algorithm</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/arch/" class="tag-list-link">arch</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/atomic/" class="tag-list-link">atomic</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/bigdata/" class="tag-list-link">bigdata</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/bytedance/" class="tag-list-link">bytedance</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/c/" class="tag-list-link">c</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/cache/" class="tag-list-link">cache</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/cli/" class="tag-list-link">cli</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/concurrency/" class="tag-list-link">concurrency</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/container/" class="tag-list-link">container</a><span
                    class="tag-list-count">6</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/containerd/" class="tag-list-link">containerd</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/database/" class="tag-list-link">database</a><span
                    class="tag-list-count">4</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/datamining/" class="tag-list-link">datamining</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/datastructure/" class="tag-list-link">datastructure</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/db/" class="tag-list-link">db</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/deploy/" class="tag-list-link">deploy</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/designpattern/" class="tag-list-link">designpattern</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/distribute/" class="tag-list-link">distribute</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/eino/" class="tag-list-link">eino</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/event-stream/" class="tag-list-link">event-stream</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/golang/" class="tag-list-link">golang</a><span
                    class="tag-list-count">20</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/http/" class="tag-list-link">http</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/interview/" class="tag-list-link">interview</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/kafka/" class="tag-list-link">kafka</a><span
                    class="tag-list-count">5</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/lsh/" class="tag-list-link">lsh</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/oauth2/" class="tag-list-link">oauth2</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/oci/" class="tag-list-link">oci</a><span
                    class="tag-list-count">5</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/other/" class="tag-list-link">other</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/overlayfs/" class="tag-list-link">overlayfs</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/proc/" class="tag-list-link">proc</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/redis/" class="tag-list-link">redis</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/rpc/" class="tag-list-link">rpc</a><span
                    class="tag-list-count">4</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/runc/" class="tag-list-link">runc</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/script/" class="tag-list-link">script</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/server/" class="tag-list-link">server</a><span
                    class="tag-list-count">3</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/socket/" class="tag-list-link">socket</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/sys/" class="tag-list-link">sys</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/taskqueue/" class="tag-list-link">taskqueue</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/temporal/" class="tag-list-link">temporal</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/tensorflow/" class="tag-list-link">tensorflow</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/todo/" class="tag-list-link">todo</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/underthehood/" class="tag-list-link">underthehood</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/ut/" class="tag-list-link">ut</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/vue/" class="tag-list-link">vue</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/workflow/" class="tag-list-link">workflow</a><span
                    class="tag-list-count">2</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/wsl/" class="tag-list-link">wsl</a><span
                    class="tag-list-count">1</span></li>
            
            
            <li class="tag-list-item"><a href="https://wymli.github.io/tags/zookeeper/" class="tag-list-link">zookeeper</a><span
                    class="tag-list-count">1</span></li>
            
        </ul>

    </div>
</div>
      
<div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
        <ul class="recent-post-list list-unstyled no-thumbnail">
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://wymli.github.io/2021/04/a2todo-todo-list/" class="title">TodoList</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-04-08 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-04-08</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://wymli.github.io/2021/04/a1underthehood-underthehood/" class="title">[UnderTheHood] åŸºç¡€-é‡è¦-çŸ¥è¯†-æ•™æ—¨-æ ¼è¨€-è‰</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2021-04-10 00:00:00 &#43;0000 UTC" itemprop="datePublished">2021-04-10</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://wymli.github.io/2025/05/aiagent-eino/" class="title">[AI Agent] Eino</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2025-05-16 00:00:00 &#43;0000 UTC" itemprop="datePublished">2025-05-16</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://wymli.github.io/2025/05/db-mutex/" class="title">[DB] äº‹åŠ¡éš”ç¦»ä¸é”</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2025-05-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">2025-05-14</time>
                    </p>
                </div>
            </li>
            <li>
                <div class="item-inner">
                    <p class="item-title">
                        <a href="https://wymli.github.io/2025/05/go-gmp/" class="title">[Go] GMP</a>
                    </p>
                    <p class="item-date">
                        <time datetime="2025-05-11 00:00:00 &#43;0000 UTC" itemprop="datePublished">2025-05-11</time>
                    </p>
                </div>
            </li>
        </ul>
    </div>
</div>
  </div>
</aside>

    
    
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <h4 class="toc-title">Catalogue</h4>
    <nav id="toc" class="js-toc toc">

    </nav>
  </div>
</aside>
<main class="main" role="main"><div class="content">
  <article id="-" class="article article-type-" itemscope
    itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      <h1 itemprop="name">
  <a
    class="article-title"
    href="/2025/05/aiagent-eino/"
    >[AI Agent] Eino</a
  >
</h1>

      <div class="article-meta">
        
<span class="article-date">
  <i class="icon icon-calendar-check"></i>&nbsp;
<a href="https://wymli.github.io/2025/05/aiagent-eino/" class="article-date">
  <time datetime="2025-05-16 00:00:00 &#43;0000 UTC" itemprop="datePublished">2025-05-16</time>
</a>
</span>
<span class="article-category">
  <i class="icon icon-folder"></i>&nbsp;
  <a class="article-category-link" href="/categories/ai-agent/"> ai agent </a>
</span>  
  <span class="article-tag">
    <i class="icon icon-tags"></i>&nbsp;
    <a class="article-tag-link" href="/tags/ai-agent/"> ai agent </a>
    <a class="article-tag-link" href="/tags/eino/"> eino </a>
  </span>

		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 5531 words</span>
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Time: 12 minutes </span>
      </div>
    </div>
    <div class="article-entry marked-body js-toc-content" itemprop="articleBody">
      <blockquote>
<p>åŸæ–‡æˆ‘è®°å½•åœ¨é£ä¹¦æ–‡æ¡£: <a href="https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b">https://c6t4wbgxht.feishu.cn/docx/WLmndFiDgokHVvxoBkZczB67n3b</a>
æ‹·è´æ—¶ä¼šæœ‰æ ¼å¼é—®é¢˜</p></blockquote>
<p>Eino æ˜¯å­—èŠ‚å¼€æºçš„golangå†™çš„ ai agent å¼€å‘æ¡†æ¶ï¼Œç±»ä¼¼pythonå†™çš„langchainã€llamaindexã€‚
Ai agent æ™ºèƒ½ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§å®Œæˆ â€œæ„ŸçŸ¥ã€æ€è€ƒã€æ‰§è¡Œâ€ çš„ç¨‹åºï¼Œå…¶ä¸­æ€è€ƒçš„éƒ¨åˆ†å€ŸåŠ©å¤§æ¨¡å‹å®Œæˆ
å¤§æ¨¡å‹æœ‰ä¸‰ç§ä¸»è¦çš„åº”ç”¨æ¨¡å¼ï¼š</p>
<ol>
<li>ç›´æ¥å¯¹è¯</li>
<li>çŸ¥è¯†åº“ RAG</li>
<li>AI Agent å·¥å…·è°ƒç”¨</li>
</ol>
<p>é’ˆå¯¹ä¸‰ç§ä¸»è¦åº”ç”¨æ¨¡å¼ï¼ŒEinoæœ‰å¦‚ä¸‹å‡ ç§ç»„ä»¶æŠ½è±¡ï¼š</p>
<ol>
<li>å¯¹è¯ï¼š</li>
<li>ChatTemplate</li>
<li>ChatModel</li>
<li>çŸ¥è¯†åº“ï¼š</li>
<li>æ–‡æœ¬åŠ è½½å’Œå¤„ç†ï¼šDocument.Loader, Document.Transformer</li>
<li>æ–‡æœ¬ç¼–ç ï¼šEmbedding ï¼ˆè°ƒç”¨å¤§æ¨¡å‹ç¼–ç ï¼‰</li>
<li>å‘é‡å­˜å‚¨ï¼šIndexer</li>
<li>å¬å›ï¼šRetriever</li>
<li>AI Agentå†³ç­–æ‰§è¡Œï¼š</li>
<li>ToolsNode</li>
<li>è‡ªå®šä¹‰ç»„ä»¶ï¼š</li>
<li>Lambdaï¼šè‡ªå·±å®ç°å…·ä½“çš„é€»è¾‘</li>
</ol>
<h1 id="quick-start">Quick Start</h1>
<h2 id="chat">Chat</h2>
<p>æŒ‰ç…§å®˜æ–¹ç¤ºä¾‹ï¼Œç®€å•æ”¹äº†ä¸‹ï¼Œæœ‰å¦‚ä¸‹çš„ä»£ç ï¼Œä¸€ä¸ªæç®€çš„åµŒå…¥é¢„ç½®promptå’Œå¯¹è¯çš„ä¾‹å­ï¼š
æµç¨‹ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ol>
<li>åˆ›å»ºprompt tmpl</li>
<li>æ¸²æŸ“prompt tmplå¾—åˆ° inputMessages</li>
<li>åˆ›å»ºchatModel</li>
<li>è°ƒç”¨chatModelï¼Œå°†inputMessagesä¼ å…¥</li>
<li>ChatModelæ˜¯ä¸åŒå¤§è¯­è¨€æ¨¡å‹çš„æŠ½è±¡æ¥å£</li>
</ol>
<pre><code>type ChatModel interface {
    // è·å¾—å®Œæ•´è¾“å‡º
    Generate(ctx context.Context, input []*schema.Message, opts ...Option) (*schema.Message, error)
    // é€ä¸ªtokenè¾“å‡º
    Stream(ctx context.Context, input []*schema.Message, opts ...Option) (
        *schema.StreamReader[*schema.Message], error)

    // BindTools bind tools to the model.
    // BindTools before requesting ChatModel generally.
    // notice the non-atomic problem of BindTools and Generate.
    BindTools(tools []*schema.ToolInfo) error
}
</code></pre>
<pre><code>/*
 * Copyright 2024 CloudWeGo Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package main

import (
    &quot;context&quot;
    &quot;io&quot;
    &quot;iter&quot;
    &quot;log&quot;

    &quot;github.com/cloudwego/eino-ext/components/model/ollama&quot;
    &quot;github.com/cloudwego/eino/components/prompt&quot;
    &quot;github.com/cloudwego/eino/schema&quot;
)


func main() {
    ctx := context.Background()

    // åˆ›å»ºæ¨¡æ¿ï¼Œä½¿ç”¨ FString æ ¼å¼
    tmpl := prompt.FromMessages(schema.FString,
        // ç³»ç»Ÿæ¶ˆæ¯æ¨¡æ¿
        schema.SystemMessage(&quot;ä½ æ˜¯ä¸€ä¸ª{role}ã€‚ä½ éœ€è¦ç”¨{style}çš„è¯­æ°”å›ç­”é—®é¢˜ã€‚ä½ çš„ç›®æ ‡æ˜¯å¸®åŠ©ç¨‹åºå‘˜ä¿æŒç§¯æä¹è§‚çš„å¿ƒæ€ï¼Œæä¾›æŠ€æœ¯å»ºè®®çš„åŒæ—¶ä¹Ÿè¦å…³æ³¨ä»–ä»¬çš„å¿ƒç†å¥åº·ã€‚&quot;),

        // æ’å…¥éœ€è¦çš„å¯¹è¯å†å²ï¼ˆæ–°å¯¹è¯çš„è¯è¿™é‡Œä¸å¡«ï¼‰
        schema.MessagesPlaceholder(&quot;chat_history&quot;, true),

        // ç”¨æˆ·æ¶ˆæ¯æ¨¡æ¿
        schema.UserMessage(&quot;é—®é¢˜: {question}&quot;),
    )

    // ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæ¶ˆæ¯
    messages, err := tmpl.Format(context.Background(), map[string]any{
        &quot;role&quot;:     &quot;ç¨‹åºå‘˜é¼“åŠ±å¸ˆ&quot;,
        &quot;style&quot;:    &quot;ç§¯æã€æ¸©æš–ä¸”ä¸“ä¸š&quot;,
        &quot;question&quot;: &quot;æˆ‘çš„ä»£ç ä¸€ç›´æŠ¥é”™ï¼Œæ„Ÿè§‰å¥½æ²®ä¸§ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ&quot;,
        // å¯¹è¯å†å²ï¼ˆè¿™ä¸ªä¾‹å­é‡Œæ¨¡æ‹Ÿä¸¤è½®å¯¹è¯å†å²ï¼‰
        &quot;chat_history&quot;: []*schema.Message{
            schema.UserMessage(&quot;ä½ å¥½&quot;),
            schema.AssistantMessage(&quot;å˜¿ï¼æˆ‘æ˜¯ä½ çš„ç¨‹åºå‘˜é¼“åŠ±å¸ˆï¼è®°ä½ï¼Œæ¯ä¸ªä¼˜ç§€çš„ç¨‹åºå‘˜éƒ½æ˜¯ä» Debug ä¸­æˆé•¿èµ·æ¥çš„ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ&quot;, nil),
            schema.UserMessage(&quot;æˆ‘è§‰å¾—è‡ªå·±å†™çš„ä»£ç å¤ªçƒ‚äº†&quot;),
            schema.AssistantMessage(&quot;æ¯ä¸ªç¨‹åºå‘˜éƒ½ç»å†è¿‡è¿™ä¸ªé˜¶æ®µï¼é‡è¦çš„æ˜¯ä½ åœ¨ä¸æ–­å­¦ä¹ å’Œè¿›æ­¥ã€‚è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä»£ç ï¼Œæˆ‘ç›¸ä¿¡é€šè¿‡é‡æ„å’Œä¼˜åŒ–ï¼Œå®ƒä¼šå˜å¾—æ›´å¥½ã€‚è®°ä½ï¼ŒRome wasn't built in a dayï¼Œä»£ç è´¨é‡æ˜¯é€šè¿‡æŒç»­æ”¹è¿›æ¥æå‡çš„ã€‚&quot;, nil),
        },
    })
    if err != nil {
        log.Fatalf(&quot;format template failed: %v\n&quot;, err)
    }

    // è¿æ¥ollmaå¹¶åˆ›å»ºchatModel
    // ç®€å•å®‰è£…ä¸€ä¸‹ollmaå°±è¡Œ: curl -fsSL https://ollama.com/install.sh | sh
    // ç„¶åä¸‹è½½æ¨¡å‹ï¼šollama pull llama2
    chatModel, err := ollama.NewChatModel(ctx, &amp;ollama.ChatModelConfig{
        BaseURL: &quot;http://localhost:11434&quot;, // Ollama æœåŠ¡åœ°å€
        Model:   &quot;llama2&quot;,                 // æ¨¡å‹åç§°
    })
    if err != nil {
        log.Fatalf(&quot;create ollama chat model failed: %v&quot;, err)
    }

    result, err := chatModel.Generate(ctx, messages)
    if err != nil {
        log.Fatalf(&quot;llm generate failed: %v&quot;, err)
    }
    log.Printf(&quot;result: %s\n\n&quot;, JsonIndent(result))

    streamResult, err := chatModel.Stream(ctx, messages)
    if err != nil {
        log.Fatalf(&quot;llm generate failed: %v&quot;, err)
    }

    for msg, iterInfo := range NewStreamResultIter(streamResult) {
        log.Printf(&quot;message[%d]: %+v, err=%v\n&quot;, iterInfo.I, msg, iterInfo.Err)
    }
}

func JsonIndent(v any) string {
    x, _ := json.MarshalIndent(v, &quot;&quot;, &quot;\t&quot;)
    return *(*string)(unsafe.Pointer(&amp;x))
}

type IterInfo struct {
    I   int
    Err error
}

func NewStreamResultIter(sr *schema.StreamReader[*schema.Message]) iter.Seq2[*schema.Message, IterInfo] {
    return func(yield func(*schema.Message, IterInfo) bool) {
        defer sr.Close()

        i := 0
        for {
            message, err := sr.Recv()
            if err == io.EOF {
                return
            }
            if !yield(message, IterInfo{i, err}) {
                return
            }

            i++
        }
    }
}
</code></pre>
<h2 id="ai-agent">AI Agent</h2>
<p>ç†Ÿè®° â€œæ„ŸçŸ¥-æ€è€ƒ-æ‰§è¡Œâ€ï¼Œæ„ŸçŸ¥å°±æ˜¯æä¾›ç»™å¤§æ¨¡å‹ä¸€äº›ä¸Šä¸‹æ–‡ï¼Œæ€è€ƒå°±æ˜¯å¤§æ¨¡å‹è°ƒç”¨ï¼Œæ‰§è¡Œå°±æ˜¯å¤§æ¨¡å‹æ‰§è¡Œå‡½æ•°è°ƒç”¨ã€‚åº”ç”¨äºai agentçš„å¤§æ¨¡å‹éœ€è¦æ”¯æŒå‡½æ•°è°ƒç”¨ã€‚æ¯”å¦‚åœ¨ollamaé‡Œï¼Œä¼šä»¥toolsæ ‡è®°ã€‚
æµç¨‹ä¹Ÿä¸å¤æ‚ï¼š</p>
<ol>
<li>ç¼–å†™tool</li>
<li>å°†toolæ³¨å†Œåˆ°chatModel</li>
<li>æ„å»ºtoolNode</li>
<li>æ„å»ºchain</li>
<li>å°†toolNodeæ·»åŠ åˆ°chain</li>
<li>ç¼–è¯‘chain</li>
<li>è°ƒç”¨chain</li>
</ol>
<pre><code>import toolutils &quot;github.com/cloudwego/eino/components/tool/utils&quot;
type CreateTodoOpts struct {
    Content string `json:&quot;content,omitempty&quot; jsonschema:&quot;description=content of the todo&quot;`
    EndTime int64  `json:&quot;end_time,omitempty&quot; jsonschema:&quot;description=deadline of the todo&quot;`
}

func (p *CreateTodoOpts) Invoke(_ context.Context, params *CreateTodoOpts) (string, error) {
    logs.Infof(&quot;invoke tool create_todo: %+v&quot;, params)
    // biz logic
    return `{&quot;msg&quot;: &quot;create todo success&quot;}`, nil
}

func main(){
    // æ„å»ºtool
    createTool, err := toolutils.InferTool(&quot;create_todo&quot;, &quot;Create a todo item, eg: content,end_time...&quot;, (&amp;CreateTodoOpts{}).Invoke)
    if err != nil {
        logs.Errorf(&quot;InferTool failed, err=%v&quot;, err)
        return
    }
    
    tools := []tool.BaseTool{
        createTool,
    }
    
    // å°† tools ç»‘å®šåˆ° ChatModel
    err = chatModel.BindTools(lo.Map(todoTools, func(v tool.BaseTool, _ int) *schema.ToolInfo {
        info, _ := v.Info(ctx)
        return info
    }))
    if err != nil {
        logs.Errorf(&quot;BindTools failed, err=%v&quot;, err)
        return
    }
    
    // æ„å»º toolsNode èŠ‚ç‚¹
    todoToolsNode, err := compose.NewToolNode(ctx, &amp;compose.ToolsNodeConfig{
        Tools: todoTools,
    })
    if err != nil {
        logs.Errorf(&quot;NewToolNode failed, err=%v&quot;, err)
        return
    }

    // æ„å»ºå®Œæ•´çš„å¤„ç†é“¾
    chain := compose.NewChain[[]*schema.Message, []*schema.Message]()
    chain.
        AppendChatModel(chatModel, compose.WithNodeName(&quot;chat_model&quot;)).
        AppendToolsNode(todoToolsNode, compose.WithNodeName(&quot;tools&quot;))

    // ç¼–è¯‘å¹¶è¿è¡Œ chain
    agent, err := chain.Compile(ctx)
    if err != nil {
        logs.Errorf(&quot;chain.Compile failed, err=%v&quot;, err)
        return
    }
    
    resp, err := agent.Invoke(ctx, []*schema.Message{{...}})
    if err != nil {
        logs.Errorf(&quot;agent.Invoke failed, err=%v&quot;, err)
        return
    }
}
</code></pre>
<h1 id="graphchainworkflow">Graph/Chain/Workflow</h1>
<p>Graph: low-level çš„ç±»å‹ï¼Œéœ€è¦æ“ä½œèŠ‚ç‚¹å’Œè¾¹
Chain: high-level çš„ç±»å‹ï¼Œåº•å±‚æ“ä½œgraph, pregel æ¨¡å¼ã€‚chainçš„å…¸å‹æ“ä½œæ˜¯ç›´æ¥appendï¼Œä¸æ–­çš„çº§è”æ“ä½œï¼Œä¸€å¾€æ— å‰ï¼Œæ— æ³•å½¢æˆç¯æ“ä½œï¼ˆä½†æ˜¯ai agentçš„å¼€å‘ä¸­ï¼Œæ¯”å¦‚ReActå°±æ˜¯ç¯ï¼‰ï¼Œé»˜è®¤æ˜¯
Workflowï¼šhigh-level çš„ç±»å‹ï¼Œåº•å±‚æ“ä½œgraph, dag æ¨¡å¼ã€‚ä¸æ”¯æŒç¯ã€‚AllPredecessor è¯­ä¹‰</p>
<p>chainå’Œworkflow ä¸»è¦æ˜¯åœ¨æ‰§è¡Œæ—¶è·å–ä¸‹ä¸€æ‰¹å¾…æ‰§è¡ŒèŠ‚ç‚¹æ—¶æœ‰åŒºåˆ«ï¼Œ</p>
<h1 id="component">Component</h1>
<p>æ³¨æ„åŒºåˆ†èŠ‚ç‚¹ï¼Œå’ŒæŒ‚åœ¨èŠ‚ç‚¹ä¸Šçš„invokeFunc!</p>
<h2 id="tools">Tools</h2>
<p>compose.ToolsNode
è¿™æ˜¯ä¸€ä¸ªå›¾èŠ‚ç‚¹ï¼Œå­˜æ”¾toolsã€‚</p>
<ol>
<li>ä¸ºä»€ä¹ˆæ˜¯toolsNodeè€Œä¸æ˜¯toolNodeï¼Ÿ</li>
<li>å’Œå¤§æ¨¡å‹å‡½æ•°è°ƒç”¨æœºåˆ¶æœ‰å…³ï¼Œåœ¨å¤§æ¨¡å‹å‡½æ•°è°ƒç”¨é‡Œï¼Œæ˜¯å¤§æ¨¡å‹è¿”å›éœ€è¦è°ƒç”¨çš„å‡½æ•°åå’Œå‡½æ•°å‚æ•°ï¼Œæˆ‘ä»¬è‡ªå·±å†å»è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“æœ‰å“ªäº›å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œé‚£å½“ç„¶æ˜¯éƒ½æ”¾åœ¨ä¸€ä¸ªnodeé‡Œæ¥æŸ¥æ‰¾äº†ã€‚
ToolsNode.Invoke
å›¾èŠ‚ç‚¹æ¥æ”¶ä¸€ä¸ªinput <em>schema.Message, è¿”å›å¤šä¸ª</em>schema.Message
ä¹Ÿæ¯”è¾ƒåˆç†ï¼Œmessageé‡Œçš„ToolCallsæ˜¯ä¸ªåˆ—è¡¨ï¼Œå¯èƒ½æœ‰å¤šä¸ªå‡½æ•°è°ƒç”¨è¢«è§¦å‘ï¼Œå¯¹äºæ¯ä¸ªè§¦å‘çš„å‡½æ•°è°ƒç”¨ï¼Œéƒ½æ·»åŠ åˆ°è¿”å›å€¼é‡Œ</li>
</ol>
<pre><code>(tn *ToolsNode) Invoke(ctx context.Context, input *schema.Message,opts ...ToolsNodeOption) ([]*schema.Message, error)

tool.InvokableTool / StreamableTool 
åœ¨einoä¸­ï¼Œtoolè¢«å®šä¹‰ä¸ºä¸€ç§interfaceï¼š
// BaseTool get tool info for ChatModel intent recognition.
type BaseTool interface {
    // infoæ–¹æ³•è¿”å›å‚æ•°ç»“æ„ä½“çš„json schemaï¼Œè¢«ç”¨äºå¤§æ¨¡å‹çš„function callæ³¨å†Œ
    Info(ctx context.Context) (*schema.ToolInfo, error)
}

// InvokableTool the tool for ChatModel intent recognition and ToolsNode execution.
// nolint: byted_s_interface_name
type InvokableTool interface {
    BaseTool

    // InvokableRun call function with arguments in JSON format
    // InvokableRunæˆ–StreamableRun æ˜¯å®é™…æ‰§è¡Œçš„å‡½æ•°ï¼Œé‡Œé¢ä¼šè°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å‡½æ•°ã€‚
    // éœ€è¦æ³¨æ„çš„æ˜¯ InvokableRun æ¥å— argumentsInJSON stringå‚æ•°ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„æ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥ä¸­é—´ä¼šå‘é€åºåˆ—åŒ–æ“ä½œï¼Œæ¡†æ¶å†…éƒ¨å®Œæˆè¯¥åºåˆ—åŒ–
    // æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå¤§æ¨¡å‹çš„åœ¨tool_callså­—æ®µé‡Œçš„å“åº”è‚¯å®šæ˜¯stringçš„ï¼Œè¿™é‡ŒInvokableRunå°±æ˜¯ç›´æ¥æ¥æ”¶å¤§æ¨¡å‹çš„è¾“å‡ºï¼Œæˆ–è€…è¯´ä¸Šä¸ªèŠ‚ç‚¹çš„è¾“å‡º
    InvokableRun(ctx context.Context, argumentsInJSON string, opts ...Option) (string, error)
}

// StreamableTool the stream tool for ChatModel intent recognition and ToolsNode execution.
// nolint: byted_s_interface_name
type StreamableTool interface {
    BaseTool

    StreamableRun(ctx context.Context, argumentsInJSON string, opts ...Option) (*schema.StreamReader[string], error)
}
</code></pre>
<p>einoæä¾›äº†ä¸¤ç§æ–¹æ³•åˆ›å»ºtool:</p>
<ul>
<li>tool.NewTool
<ul>
<li>ä¼ å…¥å‚æ•°ç»“æ„schemaå’Œå¯¹åº”çš„å¤„ç†å‡½æ•°</li>
</ul>
</li>
<li>toolutils.InferTool
<ul>
<li>ä¼ å…¥å‚æ•°ç»“æ„ä½“ï¼ˆschemaå†™åœ¨æ³¨è§£ä¸­ï¼‰å’Œå¯¹åº”çš„å¤„ç†å‡½æ•°
ç”±äºtoolæ˜¯ä¸€ç§interfaceï¼Œæ˜¾ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ï¼šcustom struct impl interface</li>
</ul>
</li>
</ul>
<h1 id="åƒé€react">åƒé€ReAct</h1>
<pre><code>/*
 * Copyright 2024 CloudWeGo Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package react

import (
    &quot;context&quot;
    &quot;io&quot;

    &quot;github.com/cloudwego/eino/components/model&quot;
    &quot;github.com/cloudwego/eino/compose&quot;
    &quot;github.com/cloudwego/eino/flow/agent&quot;
    &quot;github.com/cloudwego/eino/schema&quot;
)

type state struct {
    Messages                 []*schema.Message
    ReturnDirectlyToolCallID string
}

const (
    nodeKeyTools = &quot;tools&quot;
    nodeKeyModel = &quot;chat&quot;
)

// MessageModifier modify the input messages before the model is called.
type MessageModifier func(ctx context.Context, input []*schema.Message) []*schema.Message

// AgentConfig is the config for ReAct agent.
type AgentConfig struct {
    // ToolCallingModel is the chat model to be used for handling user messages with tool calling capability.
    // This is the recommended model field to use.
    ToolCallingModel model.ToolCallingChatModel

    // Deprecated: Use ToolCallingModel instead.
    Model model.ChatModel

    // ToolsConfig is the config for tools node.
    ToolsConfig compose.ToolsNodeConfig

    // MessageModifier.
    // modify the input messages before the model is called, it's useful when you want to add some system prompt or other messages.
    MessageModifier MessageModifier

    // MaxStep.
    // default 12 of steps in pregel (node num + 10).
    MaxStep int `json:&quot;max_step&quot;`

    // Tools that will make agent return directly when the tool is called.
    // When multiple tools are called and more than one tool is in the return directly list, only the first one will be returned.
    ToolReturnDirectly map[string]struct{}

    // StreamOutputHandler is a function to determine whether the model's streaming output contains tool calls.
    // Different models have different ways of outputting tool calls in streaming mode:
    // - Some models (like OpenAI) output tool calls directly
    // - Others (like Claude) output text first, then tool calls
    // This handler allows custom logic to check for tool calls in the stream.
    // It should return:
    // - true if the output contains tool calls and agent should continue processing
    // - false if no tool calls and agent should stop
    // Note: This field only needs to be configured when using streaming mode
    // Note: The handler MUST close the modelOutput stream before returning
    // Optional. By default, it checks if the first chunk contains tool calls.
    // Note: The default implementation does not work well with Claude, which typically outputs tool calls after text content.
    // Note: If your ChatModel doesn't output tool calls first, you can try adding prompts to constrain the model from generating extra text during the tool call.
    StreamToolCallChecker func(ctx context.Context, modelOutput *schema.StreamReader[*schema.Message]) (bool, error)
}

// Deprecated: This approach of adding persona involves unnecessary slice copying overhead.
// Instead, directly include the persona message in the input messages when calling Generate or Stream.
//
// NewPersonaModifier add the system prompt as persona before the model is called.
// example:
//
//  persona := &quot;You are an expert in golang.&quot;
//  config := AgentConfig{
//      Model: model,
//      MessageModifier: NewPersonaModifier(persona),
//  }
//  agent, err := NewAgent(ctx, config)
//  if err != nil {return}
//  msg, err := agent.Generate(ctx, []*schema.Message{{Role: schema.User, Content: &quot;how to build agent with eino&quot;}})
//  if err != nil {return}
//  println(msg.Content)
func NewPersonaModifier(persona string) MessageModifier {
    return func(ctx context.Context, input []*schema.Message) []*schema.Message {
        res := make([]*schema.Message, 0, len(input)+1)

        res = append(res, schema.SystemMessage(persona))
        res = append(res, input...)
        return res
    }
}

func firstChunkStreamToolCallChecker(_ context.Context, sr *schema.StreamReader[*schema.Message]) (bool, error) {
    defer sr.Close()

    for {
        msg, err := sr.Recv()
        if err == io.EOF {
            return false, nil
        }
        if err != nil {
            return false, err
        }

        if len(msg.ToolCalls) &gt; 0 {
            return true, nil
        }

        if len(msg.Content) == 0 { // skip empty chunks at the front
            continue
        }

        return false, nil
    }
}

const (
    GraphName     = &quot;ReActAgent&quot;
    ModelNodeName = &quot;ChatModel&quot;
    ToolsNodeName = &quot;Tools&quot;
)

// Agent is the ReAct agent.
// ReAct agent is a simple agent that handles user messages with a chat model and tools.
// ReAct will call the chat model, if the message contains tool calls, it will call the tools.
// if the tool is configured to return directly, ReAct will return directly.
// otherwise, ReAct will continue to call the chat model until the message contains no tool calls.
// e.g.
//
//  agent, err := ReAct.NewAgent(ctx, &amp;react.AgentConfig{})
//  if err != nil {...}
//  msg, err := agent.Generate(ctx, []*schema.Message{{Role: schema.User, Content: &quot;how to build agent with eino&quot;}})
//  if err != nil {...}
//  println(msg.Content)
type Agent struct {
    runnable         compose.Runnable[[]*schema.Message, *schema.Message]
    graph            *compose.Graph[[]*schema.Message, *schema.Message]
    graphAddNodeOpts []compose.GraphAddNodeOpt
}

// NewAgent creates a ReAct agent that feeds tool response into next round of Chat Model generation.
//
// IMPORTANT!! For models that don't output tool calls in the first streaming chunk (e.g. Claude)
// the default StreamToolCallChecker may not work properly since it only checks the first chunk for tool calls.
// In such cases, you need to implement a custom StreamToolCallChecker that can properly detect tool calls.
func NewAgent(ctx context.Context, config *AgentConfig) (_ *Agent, err error) {
    var (
        chatModel       model.BaseChatModel
        toolsNode       *compose.ToolsNode
        toolInfos       []*schema.ToolInfo
        toolCallChecker = config.StreamToolCallChecker
        messageModifier = config.MessageModifier
    )

    if toolCallChecker == nil {
        toolCallChecker = firstChunkStreamToolCallChecker
    }

    if toolInfos, err = genToolInfos(ctx, config.ToolsConfig); err != nil {
        return nil, err
    }

    if chatModel, err = agent.ChatModelWithTools(config.Model, config.ToolCallingModel, toolInfos); err != nil {
        return nil, err
    }

    if toolsNode, err = compose.NewToolNode(ctx, &amp;config.ToolsConfig); err != nil {
        return nil, err
    }

    graph := compose.NewGraph[[]*schema.Message, *schema.Message](compose.WithGenLocalState(func(ctx context.Context) *state {
        return &amp;state{Messages: make([]*schema.Message, 0, config.MaxStep+1)}
    }))

    // å›¾çš„IOæ ¼å¼æ˜¯ï¼ˆ[]*schema.Message, *schema.Messageï¼‰ï¼Œ æ‰€ä»¥ modelPreHandle çš„è¾“å…¥å¿…é¡»æ˜¯[]*schema.Message
    modelPreHandle := func(ctx context.Context, input []*schema.Message, state *state) ([]*schema.Message, error) {
        // æ³¨æ„ model èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥START, ä¹Ÿå¯ä»¥æ˜¯å·¥å…·èŠ‚ç‚¹ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå·¥å…·èŠ‚ç‚¹çš„è¾“å‡ºä¹Ÿæ˜¯ []*schema.Messageï¼Œç±»å‹æ˜¯å¯¹çš„ä¸Šçš„
        // è¿™é‡Œå¯ä»¥å›å¿†ä¸‹ï¼Œå·¥å…·èŠ‚ç‚¹çš„ç­¾åä¸€èˆ¬æ˜¯ï¼ˆ*schema.Message,[]*schema.Messageï¼‰, ä¸šåŠ¡ä¸€ä¸ªmessageå¯èƒ½è°ƒç”¨å¤šä¸ªfunction call
        state.Messages = append(state.Messages, input...)

        if messageModifier == nil {
            return state.Messages, nil
        }

        modifiedInput := make([]*schema.Message, len(state.Messages))
        copy(modifiedInput, state.Messages)
        return messageModifier(ctx, modifiedInput), nil
    }

    if err = graph.AddChatModelNode(nodeKeyModel, chatModel, compose.WithStatePreHandler(modelPreHandle), compose.WithNodeName(ModelNodeName)); err != nil {
        return nil, err
    }

    if err = graph.AddEdge(compose.START, nodeKeyModel); err != nil {
        return nil, err
    }

    toolsNodePreHandle := func(ctx context.Context, input *schema.Message, state *state) (*schema.Message, error) {
        state.Messages = append(state.Messages, input)
        // å­˜å‚¨ ReturnDirectlyToolCallID ä»¥ä¾¿äºèƒ½åœ¨åç»­èŠ‚ç‚¹ä¸­æ‰¾åˆ°å¯¹åº”çš„functionçš„callIDï¼ˆä¸€ä¸ªå·¥å…·èŠ‚ç‚¹å¯èƒ½è°ƒç”¨å¾ˆå¤šä¸ªfunctionï¼‰
        // æˆ‘æ„Ÿè§‰å¦‚æœmessageæœ‰ä¸ªå­—æ®µæ˜¯function_name, å…¶å®å°±è§£å†³äº†
        state.ReturnDirectlyToolCallID = getReturnDirectlyToolCallID(input, config.ToolReturnDirectly)
        return input, nil
    }
    if err = graph.AddToolsNode(nodeKeyTools, toolsNode, compose.WithStatePreHandler(toolsNodePreHandle), compose.WithNodeName(ToolsNodeName)); err != nil {
        return nil, err
    }

    modelPostBranchCondition := func(_ context.Context, sr *schema.StreamReader[*schema.Message]) (endNode string, err error) {
        // åˆ†æ”¯æ¡ä»¶ï¼Œå†³å®šå·¥å…·èŠ‚ç‚¹æ˜¯æŒ‡å‘æ¨¡å‹èŠ‚ç‚¹ï¼Œè¿˜æ˜¯æŒ‡å‘ DirectReturn èŠ‚ç‚¹
        if isToolCall, err := toolCallChecker(ctx, sr); err != nil {
            return &quot;&quot;, err
        } else if isToolCall {
            return nodeKeyTools, nil
        }
        return compose.END, nil
    }

    // æ³¨æ„ï¼ŒæŒ‡å‘Endæ—¶ï¼Œéœ€è¦ä½¿ç”¨NewStreamGraphBranchï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨Streamæ¨¡å¼è°ƒç”¨ReactAgent
    // è¿™é‡Œå¦‚æœä¸ç”¨Streamï¼Œå½“ç„¶ä¹Ÿè¡Œï¼ŒEinoä¼šå¸®æˆ‘ä»¬è¿›è¡ŒStream/Batchçš„è½¬æ¢ï¼Œä½†æ˜¯å°±ä¸æ˜¯æµå¼è¾“å‡ºäº†
    if err = graph.AddBranch(nodeKeyModel, compose.NewStreamGraphBranch(modelPostBranchCondition, map[string]bool{nodeKeyTools: true, compose.END: true})); err != nil {
        return nil, err
    }

    if len(config.ToolReturnDirectly) &gt; 0 {
        if err = buildReturnDirectly(graph); err != nil {
            return nil, err
        }
    } else if err = graph.AddEdge(nodeKeyTools, nodeKeyModel); err != nil {
        return nil, err
    }

    compileOpts := []compose.GraphCompileOption{compose.WithMaxRunSteps(config.MaxStep), compose.WithNodeTriggerMode(compose.AnyPredecessor), compose.WithGraphName(GraphName)}
    runnable, err := graph.Compile(ctx, compileOpts...)
    if err != nil {
        return nil, err
    }

    return &amp;Agent{
        runnable:         runnable,
        graph:            graph,
        graphAddNodeOpts: []compose.GraphAddNodeOpt{compose.WithGraphCompileOptions(compileOpts...)},
    }, nil
}

func buildReturnDirectly(graph *compose.Graph[[]*schema.Message, *schema.Message]) (err error) {
    // æ³¨æ„ directReturn çš„ç­¾åï¼Œæ¯”è¾ƒæœ‰æ„æ€ ï¼ˆ*schema.StreamReader[[]*schema.Message] ï¼Œ*schema.StreamReader[*schema.Message]ï¼‰ ï¼ŒdirectReturnèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æ˜¯å·¥å…·èŠ‚ç‚¹ï¼Œç­¾åæ˜¯[]*schema.Messageï¼Œæ‰€ä»¥è¿™é‡Œå†™*schema.StreamReader[[]*schema.Message]æˆ–è€… []*schema.Messageåº”è¯¥éƒ½è¡Œï¼Œå› ä¸ºå›¾å€¾å‘æµå¼è¾“å‡ºï¼Œæ‰€ä»¥è¾“å‡ºæ˜¯*schema.StreamReader[*schema.Message]ï¼ŒEinoå†…éƒ¨ä¼šåšæ‰¹æµçš„ç±»å‹å¤„ç†
    directReturn := func(ctx context.Context, msgs *schema.StreamReader[[]*schema.Message]) (*schema.StreamReader[*schema.Message], error) {
        return schema.StreamReaderWithConvert(msgs, func(msgs []*schema.Message) (*schema.Message, error) {
            var msg *schema.Message
            err = compose.ProcessState[*state](ctx, func(_ context.Context, state *state) error {
                for i := range msgs {
                    if msgs[i] != nil &amp;&amp; msgs[i].ToolCallID == state.ReturnDirectlyToolCallID {
                        msg = msgs[i]
                        return nil
                    }
                }
                return nil
            })
            if err != nil {
                return nil, err
            }
            if msg == nil {
                return nil, schema.ErrNoValue
            }
            return msg, nil
        }), nil
    }

    nodeKeyDirectReturn := &quot;direct_return&quot;
    if err = graph.AddLambdaNode(nodeKeyDirectReturn, compose.TransformableLambda(directReturn)); err != nil {
        return err
    }

    // this branch checks if the tool called should return directly. It either leads to END or back to ChatModel
    err = graph.AddBranch(nodeKeyTools, compose.NewStreamGraphBranch(func(ctx context.Context, msgsStream *schema.StreamReader[[]*schema.Message]) (endNode string, err error) {
        msgsStream.Close()

        err = compose.ProcessState[*state](ctx, func(_ context.Context, state *state) error {
            if len(state.ReturnDirectlyToolCallID) &gt; 0 {
                endNode = nodeKeyDirectReturn
            } else {
                endNode = nodeKeyModel
            }
            return nil
        })
        if err != nil {
            return &quot;&quot;, err
        }
        return endNode, nil
    }, map[string]bool{nodeKeyModel: true, nodeKeyDirectReturn: true}))
    if err != nil {
        return err
    }

    return graph.AddEdge(nodeKeyDirectReturn, compose.END)
}

func genToolInfos(ctx context.Context, config compose.ToolsNodeConfig) ([]*schema.ToolInfo, error) {
    toolInfos := make([]*schema.ToolInfo, 0, len(config.Tools))
    for _, t := range config.Tools {
        tl, err := t.Info(ctx)
        if err != nil {
            return nil, err
        }

        toolInfos = append(toolInfos, tl)
    }

    return toolInfos, nil
}

func getReturnDirectlyToolCallID(input *schema.Message, toolReturnDirectly map[string]struct{}) string {
    if len(toolReturnDirectly) == 0 {
        return &quot;&quot;
    }

    for _, toolCall := range input.ToolCalls {
        if _, ok := toolReturnDirectly[toolCall.Function.Name]; ok {
            return toolCall.ID
        }
    }

    return &quot;&quot;
}

// Generate generates a response from the agent.
func (r *Agent) Generate(ctx context.Context, input []*schema.Message, opts ...agent.AgentOption) (*schema.Message, error) {
    return r.runnable.Invoke(ctx, input, agent.GetComposeOptions(opts...)...)
}

// Stream calls the agent and returns a stream response.
func (r *Agent) Stream(ctx context.Context, input []*schema.Message, opts ...agent.AgentOption) (output *schema.StreamReader[*schema.Message], err error) {
    return r.runnable.Stream(ctx, input, agent.GetComposeOptions(opts...)...)
}

// ExportGraph exports the underlying graph from Agent, along with the []compose.GraphAddNodeOpt to be used when adding this graph to another graph.
func (r *Agent) ExportGraph() (compose.AnyGraph, []compose.GraphAddNodeOpt) {
    return r.graph, r.graphAddNodeOpts
}
</code></pre>
<h1 id="å›¾æ‰§è¡Œ">å›¾æ‰§è¡Œ</h1>
<pre><code>nextTasks, result, err = r.calculateNextTasks(ctx, []*task{{
    nodeKey: START,
    call:    r.inputChannels,
    output:  input,
}}, isStream, cm, optMap) // è®¡ç®—å‡ºä¸‹ä¸€æ‰¹ä»»åŠ¡ï¼Œä»å…¨é‡èŠ‚ç‚¹mapä¸­æ‰¾åˆ° inputChannel éç©ºçš„èŠ‚ç‚¹ï¼ˆå®é™…å®ç°å’Œgraphç±»å‹æœ‰å…³ï¼Œå¦‚æœæ˜¯pregelï¼Œåªæ”¯æŒ AnyPredecessor æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ä»»ä¸€ä¸ªä¾èµ–å®Œæˆï¼Œå½“å‰èŠ‚ç‚¹å°±å¯ä»¥è¿è¡Œï¼‰
for step := 0; ; step++ {
        // Check for context cancellation.
        select {
        case &lt;-ctx.Done():
            _ = tm.waitAll()
            return nil, newGraphRunError(fmt.Errorf(&quot;context has been canceled: %w&quot;, ctx.Err()))
        default:
        }
        if !r.dag &amp;&amp; step &gt;= maxSteps {
            return nil, newGraphRunError(ErrExceedMaxSteps)
        }

        // 1. submit next tasks
        // 2. get completed tasks
        // 3. calculate next tasks

        err = tm.submit(nextTasks) // å¼‚æ­¥æˆ–åŒæ­¥çš„æäº¤ä¸€æ‰¹ä»»åŠ¡
        if err != nil {
            return nil, newGraphRunError(fmt.Errorf(&quot;failed to submit tasks: %w&quot;, err))
        }
        var completedTasks []*task
        completedTasks = tm.wait() // é»˜è®¤æ˜¯ wait one, ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªèŠ‚ç‚¹å¥½ä¹‹åï¼Œå¼€å§‹ä¸‹ä¸€è½®ä¸»å¾ªç¯
        
        
        // ...
        nextTasks, result, err = r.calculateNextTasks(ctx, completedTasks, isStream, cm, optMap)
        // ...
}
func (t *taskManager) submit(tasks []*task) error {
    // ...
    for _, currentTask := range tasks {
        t.num += 1
        go t.execute(currentTask)
    }
    // ...
}

func (t *taskManager) execute(currentTask *task) {
    defer func() {
        panicInfo := recover()
        if panicInfo != nil {
            currentTask.output = nil
            currentTask.err = safe.NewPanicErr(panicInfo, debug.Stack())
        }

        t.done.Send(currentTask)
    }()

    ctx := initNodeCallbacks(currentTask.ctx, currentTask.nodeKey, currentTask.call.action.nodeInfo, currentTask.call.action.meta, t.opts...)
    currentTask.output, currentTask.err = t.runWrapper(ctx, currentTask.call.action, currentTask.input, currentTask.option...)
}

func (t *taskManager) wait() []*task {
    if t.needAll {
        return t.waitAll()
    }

    ta, success := t.waitOne()
    if !success {
        return []*task{}
    }

    return []*task{ta}
}
</code></pre>
<h2 id="passthrough-èŠ‚ç‚¹">passthrough èŠ‚ç‚¹</h2>
<p>åœ¨AnyPredecessor è¯­ä¹‰æ‰§è¡Œæ—¶ï¼Œä»»ä¸€å‰ç½®èŠ‚ç‚¹ä¼šè§¦å‘åç»­èŠ‚ç‚¹æ‰§è¡Œ
å¯¹äºå¦‚ä¸‹çš„å›¾ï¼š
a -&gt; b -&gt; c
a -&gt; c
å½“aæ‰§è¡Œå®Œåï¼Œbå’Œcä¼šä¸€èµ·æ‰§è¡Œï¼Œè‚¯å®šä¸ç¬¦åˆé¢„æœŸï¼Œæ‰€ä»¥éœ€è¦åœ¨a-&gt;c ç›´æ¥æ’å…¥ passthrough (actually nop) èŠ‚ç‚¹ï¼Œç­‰ä¸€å›åˆå†æ‰§è¡Œ</p>
<h1 id="å†…éƒ¨éšå¼ç±»å‹è½¬æ¢">å†…éƒ¨éšå¼ç±»å‹è½¬æ¢ï¼š</h1>
<ul>
<li>å¦‚æœä¸Šä¸‹æ¸¸èŠ‚ç‚¹çš„æµç±»å‹æ— æ³•åŒ¹é…ã€‚ Einoä¼šè‡ªåŠ¨å®Œæˆ æµåŒ–ã€åˆåŒ… ä¸¤ä¸ªæ“ä½œ
<ul>
<li>æµåŒ–(Streaming)ï¼šå°† T æµåŒ–æˆå• Chunk çš„ Stream[T]</li>
<li>åˆåŒ…(Concat)ï¼šå°† Stream[T] åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„ Tã€‚</li>
</ul>
</li>
<li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è¦æ¥æ”¶å¤šä¸ªèŠ‚ç‚¹çš„è¾“å‡ºï¼ˆå³AllPredessoræ¨¡å¼ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦å°†è¾“å‡ºå®šä¹‰æˆMap, ä»¥æ–¹ä¾¿åˆå¹¶è¾“å‡º</li>
</ul>

    </div>
    <div class="article-footer">
<blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    <li class="post-copyright-link hidden-xs">
      <strong>Permalink: </strong>
      <a href="https://wymli.github.io/2025/05/aiagent-eino/" title="[AI Agent] Eino" target="_blank" rel="external">https://wymli.github.io/2025/05/aiagent-eino/</a>
    </li>
    <li class="post-copyright-license">
      <strong>License: </strong>
        <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN</a>
    </li>
  </ul>
</blockquote>

<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/wymli" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://wymli.github.io/me.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/wymli" target="_blank"><span class="text-dark">Li Weiming</span><small class="ml-1x">wymli@sysu.cse</small></a></h3>
        <div>ONE CAN GO FAST</div>
      </div>
    </figure>
  </div>
</div>

    </div>
  </article>
</div><nav class="bar bar-footer clearfix" data-stick-bottom>
    <div class="bar-inner">
        <ul class="pager pull-left">
            <li class="prev">
                <a href="https://wymli.github.io/2025/05/db-mutex/" title="[DB] äº‹åŠ¡éš”ç¦»ä¸é”"><i
                        class="icon icon-angle-left"
                        aria-hidden="true"></i><span>&nbsp;&nbsp;Older</span></a>
            </li>
            <li class="next">
                <a href="https://wymli.github.io/2021/04/a1underthehood-underthehood/"
                    title="[UnderTheHood] åŸºç¡€-é‡è¦-çŸ¥è¯†-æ•™æ—¨-æ ¼è¨€-è‰"><span>Newer&nbsp;&nbsp;</span><i
                        class="icon icon-angle-right" aria-hidden="true"></i></a>
            </li>
            
            <li class="toggle-toc">
                <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false"
                    title="Catalogue" role="button">
                    <span>[&nbsp;</span><span>Catalogue</span>
                    <i class="text-collapsed icon icon-anchor"></i>
                    <i class="text-in icon icon-close"></i>
                    <span>]</span>
                </a>
            </li>
        </ul>
        <div class="bar-right">
            <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter"
                data-mobile-sites="weibo,qq,qzone"></div>
        </div>
    </div>
</nav>


</main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
<ul class="social-links">
    <li><a href="https://github.com/wymli" target="_blank" title="github" data-toggle=tooltip data-placement=top >
            <i class="icon icon-github"></i></a></li>
    <li><a href="https://wymli.github.io/index.xml" target="_blank" title="rss" data-toggle=tooltip data-placement=top >
            <i class="icon icon-rss"></i></a></li>
</ul>
  <div class="copyright">
    &copy;2021  -
    2025
    <div class="publishby">
        Theme by <a href="https://github.com/xiaoheiAh" target="_blank"> xiaoheiAh </a>base on<a href="https://github.com/xiaoheiAh/hugo-theme-pure" target="_blank"> pure</a>.
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>
    window.jQuery || document.write('\x3Cscript src="js/jquery.min.js"><\/script>')
</script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/python.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/javascript.min.js" defer></script>
<script type="text/javascript" src="https://cdn.staticfile.org/highlight.js/9.15.10/languages/go.min.js" defer></script><script>
    hljs.configure({
        tabReplace: '    ', 
        classPrefix: ''     
        
    })
    hljs.initHighlightingOnLoad();
</script>
<script src="https://wymli.github.io/js/application.min.e4989ab4dc212027af8773861b05b6bc333a1217f6b0a1b3377a3a3dbd454483.js"></script>
<script src="https://wymli.github.io/js/plugin.min.353ef3573cf0beb9b69d43450140ff59f497f732396f539052fc4973c6330fdb.js"></script>

<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: 'https:\/\/wymli.github.io\/',
            CONTENT_URL: 'https:\/\/wymli.github.io\/\/searchindex.json ',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script type="text/javascript" src="https://wymli.github.io/js/insight.min.716b0c6a00b68ccc31a2b65345f3412f4246ffa94a90f8e25d525528b4504f9937880692bbe619023233caba5d0a17ebe23d7cfb57cd3a88f23ea337ad5e4d00.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
<script>
    tocbot.init({
        
        tocSelector: '.js-toc',
        
        contentSelector: '.js-toc-content',
        
        headingSelector: 'h1, h2, h3',
        
        hasInnerContainers: true,
    });
</script>



  </body>
</html>
